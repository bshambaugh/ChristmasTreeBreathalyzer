{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from'react';import{useSnackbar}from'notistack';import{Box,Fab,Paper,Typography}from'@mui/material';import ForwardIcon from'@mui/icons-material/Forward';import*as AuthenticationApi from'./api/authentication';import{PROJECT_NAME}from'./api/env';import{ValidatedTextField}from'./components';import{SIGN_IN_REQUEST_VALIDATOR,validate}from'./validators';import{extractErrorMessage,onEnterCallback,updateValue}from'./utils';import{AuthenticationContext}from'./contexts/authentication';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SignIn=function SignIn(){var authenticationContext=useContext(AuthenticationContext);var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useState=useState({username:'',password:''}),_useState2=_slicedToArray(_useState,2),signInRequest=_useState2[0],setSignInRequest=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),fieldErrors=_useState6[0],setFieldErrors=_useState6[1];var updateLoginRequestValue=updateValue(setSignInRequest);var validateAndSignIn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return validate(SIGN_IN_REQUEST_VALIDATOR,signInRequest);case 4:signIn();_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);setFieldErrors(_context.t0);setProcessing(false);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function validateAndSignIn(){return _ref.apply(this,arguments);};}();var signIn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$Authentication,loginResponse,_error$response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return AuthenticationApi.signIn(signInRequest);case 3:_yield$Authentication=_context2.sent;loginResponse=_yield$Authentication.data;authenticationContext.signIn(loginResponse.access_token);_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);if(((_error$response=_context2.t0.response)===null||_error$response===void 0?void 0:_error$response.status)===401){enqueueSnackbar(\"Invalid login details\",{variant:\"warning\"});}else{enqueueSnackbar(extractErrorMessage(_context2.t0,\"Unexpected error, please try again\"),{variant:\"error\"});}setProcessing(false);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function signIn(){return _ref2.apply(this,arguments);};}();var submitOnEnter=onEnterCallback(signIn);return/*#__PURE__*/_jsx(Box,{display:\"flex\",height:\"100vh\",margin:\"auto\",padding:2,justifyContent:\"center\",flexDirection:\"column\",maxWidth:function maxWidth(theme){return theme.breakpoints.values.sm;},children:/*#__PURE__*/_jsxs(Paper,{sx:function sx(theme){return{textAlign:\"center\",padding:theme.spacing(2),paddingTop:\"200px\",backgroundImage:'url(\"/app/icon.png\")',backgroundRepeat:\"no-repeat\",backgroundPosition:\"50% \"+theme.spacing(2),backgroundSize:\"auto 150px\",width:\"100%\"};},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:PROJECT_NAME}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,disabled:processing,name:\"username\",label:\"Username\",value:signInRequest.username,onChange:updateLoginRequestValue,margin:\"normal\",variant:\"outlined\",fullWidth:true}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,disabled:processing,type:\"password\",name:\"password\",label:\"Password\",value:signInRequest.password,onChange:updateLoginRequestValue,onKeyDown:submitOnEnter,margin:\"normal\",variant:\"outlined\",fullWidth:true}),/*#__PURE__*/_jsxs(Fab,{variant:\"extended\",color:\"primary\",sx:{mt:2},onClick:validateAndSignIn,disabled:processing,children:[/*#__PURE__*/_jsx(ForwardIcon,{sx:{mr:1}}),\"Sign In\"]})]})});};export default SignIn;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/SignIn.tsx"],"names":["useContext","useState","useSnackbar","Box","Fab","Paper","Typography","ForwardIcon","AuthenticationApi","PROJECT_NAME","ValidatedTextField","SIGN_IN_REQUEST_VALIDATOR","validate","extractErrorMessage","onEnterCallback","updateValue","AuthenticationContext","SignIn","authenticationContext","enqueueSnackbar","username","password","signInRequest","setSignInRequest","processing","setProcessing","fieldErrors","setFieldErrors","updateLoginRequestValue","validateAndSignIn","signIn","loginResponse","data","access_token","response","status","variant","submitOnEnter","theme","breakpoints","values","sm","textAlign","padding","spacing","paddingTop","backgroundImage","backgroundRepeat","backgroundPosition","backgroundSize","width","mt","mr"],"mappings":"wcAAA,OAAaA,UAAb,CAAyBC,QAAzB,KAAyC,OAAzC,CAEA,OAASC,WAAT,KAA4B,WAA5B,CAEA,OAASC,GAAT,CAAcC,GAAd,CAAmBC,KAAnB,CAA0BC,UAA1B,KAA4C,eAA5C,CACA,MAAOC,CAAAA,WAAP,KAAwB,6BAAxB,CAEA,MAAO,GAAKC,CAAAA,iBAAZ,KAAmC,sBAAnC,CACA,OAASC,YAAT,KAA6B,WAA7B,CAEA,OAASC,kBAAT,KAAmC,cAAnC,CACA,OAASC,yBAAT,CAAoCC,QAApC,KAAoD,cAApD,CACA,OAASC,mBAAT,CAA8BC,eAA9B,CAA+CC,WAA/C,KAAkE,SAAlE,CACA,OAASC,qBAAT,KAAsC,2BAAtC,C,wFAEA,GAAMC,CAAAA,MAAU,CAAG,QAAbA,CAAAA,MAAa,EAAM,CACvB,GAAMC,CAAAA,qBAAqB,CAAGlB,UAAU,CAACgB,qBAAD,CAAxC,CACA,iBAA4Bd,WAAW,EAAvC,CAAQiB,eAAR,cAAQA,eAAR,CAEA,cAA0ClB,QAAQ,CAAgB,CAChEmB,QAAQ,CAAE,EADsD,CAEhEC,QAAQ,CAAE,EAFsD,CAAhB,CAAlD,wCAAOC,aAAP,eAAsBC,gBAAtB,eAIA,eAAoCtB,QAAQ,CAAU,KAAV,CAA5C,yCAAOuB,UAAP,eAAmBC,aAAnB,eACA,eAAsCxB,QAAQ,EAA9C,yCAAOyB,WAAP,eAAoBC,cAApB,eAEA,GAAMC,CAAAA,uBAAuB,CAAGb,WAAW,CAACQ,gBAAD,CAA3C,CAEA,GAAMM,CAAAA,iBAAiB,0FAAG,mIACxBJ,aAAa,CAAC,IAAD,CAAb,CADwB,sCAGhBb,CAAAA,QAAQ,CAACD,yBAAD,CAA4BW,aAA5B,CAHQ,QAItBQ,MAAM,GAJgB,+EAMtBH,cAAc,aAAd,CACAF,aAAa,CAAC,KAAD,CAAb,CAPsB,oEAAH,kBAAjBI,CAAAA,iBAAiB,0CAAvB,CAWA,GAAMC,CAAAA,MAAM,2FAAG,wOAE2BtB,CAAAA,iBAAiB,CAACsB,MAAlB,CAAyBR,aAAzB,CAF3B,6CAEGS,aAFH,uBAEHC,IAFG,CAGXd,qBAAqB,CAACY,MAAtB,CAA6BC,aAAa,CAACE,YAA3C,EAHW,mFAKX,GAAI,+BAAMC,QAAN,0DAAgBC,MAAhB,IAA2B,GAA/B,CAAoC,CAClChB,eAAe,CAAC,uBAAD,CAA0B,CAAEiB,OAAO,CAAE,SAAX,CAA1B,CAAf,CACD,CAFD,IAEO,CACLjB,eAAe,CAACN,mBAAmB,cAAQ,oCAAR,CAApB,CAAmE,CAAEuB,OAAO,CAAE,OAAX,CAAnE,CAAf,CACD,CACDX,aAAa,CAAC,KAAD,CAAb,CAVW,sEAAH,kBAANK,CAAAA,MAAM,2CAAZ,CAcA,GAAMO,CAAAA,aAAa,CAAGvB,eAAe,CAACgB,MAAD,CAArC,CAEA,mBACE,KAAC,GAAD,EACE,OAAO,CAAC,MADV,CAEE,MAAM,CAAC,OAFT,CAGE,MAAM,CAAC,MAHT,CAIE,OAAO,CAAE,CAJX,CAKE,cAAc,CAAC,QALjB,CAME,aAAa,CAAC,QANhB,CAOE,QAAQ,CAAE,kBAACQ,KAAD,QAAWA,CAAAA,KAAK,CAACC,WAAN,CAAkBC,MAAlB,CAAyBC,EAApC,EAPZ,uBASE,MAAC,KAAD,EACE,EAAE,CAAE,YAACH,KAAD,QAAY,CACdI,SAAS,CAAE,QADG,CAEdC,OAAO,CAAEL,KAAK,CAACM,OAAN,CAAc,CAAd,CAFK,CAGdC,UAAU,CAAE,OAHE,CAIdC,eAAe,CAAE,sBAJH,CAKdC,gBAAgB,CAAE,WALJ,CAMdC,kBAAkB,CAAE,OAASV,KAAK,CAACM,OAAN,CAAc,CAAd,CANf,CAOdK,cAAc,CAAE,YAPF,CAQdC,KAAK,CAAE,MARO,CAAZ,EADN,wBAYE,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,UAA0BzC,YAA1B,EAZF,cAaE,KAAC,kBAAD,EACE,WAAW,CAAEiB,WADf,CAEE,QAAQ,CAAEF,UAFZ,CAGE,IAAI,CAAC,UAHP,CAIE,KAAK,CAAC,UAJR,CAKE,KAAK,CAAEF,aAAa,CAACF,QALvB,CAME,QAAQ,CAAEQ,uBANZ,CAOE,MAAM,CAAC,QAPT,CAQE,OAAO,CAAC,UARV,CASE,SAAS,KATX,EAbF,cAwBE,KAAC,kBAAD,EACE,WAAW,CAAEF,WADf,CAEE,QAAQ,CAAEF,UAFZ,CAGE,IAAI,CAAC,UAHP,CAIE,IAAI,CAAC,UAJP,CAKE,KAAK,CAAC,UALR,CAME,KAAK,CAAEF,aAAa,CAACD,QANvB,CAOE,QAAQ,CAAEO,uBAPZ,CAQE,SAAS,CAAES,aARb,CASE,MAAM,CAAC,QATT,CAUE,OAAO,CAAC,UAVV,CAWE,SAAS,KAXX,EAxBF,cAqCE,MAAC,GAAD,EAAK,OAAO,CAAC,UAAb,CAAwB,KAAK,CAAC,SAA9B,CAAwC,EAAE,CAAE,CAAEc,EAAE,CAAE,CAAN,CAA5C,CAAuD,OAAO,CAAEtB,iBAAhE,CAAmF,QAAQ,CAAEL,UAA7F,wBACE,KAAC,WAAD,EAAa,EAAE,CAAE,CAAE4B,EAAE,CAAE,CAAN,CAAjB,EADF,aArCF,GATF,EADF,CAsDD,CA9FD,CAgGA,cAAenC,CAAAA,MAAf","sourcesContent":["import { FC, useContext, useState } from 'react';\nimport { ValidateFieldsError } from 'async-validator';\nimport { useSnackbar } from 'notistack';\n\nimport { Box, Fab, Paper, Typography } from '@mui/material';\nimport ForwardIcon from '@mui/icons-material/Forward';\n\nimport * as AuthenticationApi from './api/authentication';\nimport { PROJECT_NAME } from './api/env';\nimport { SignInRequest } from './types';\nimport { ValidatedTextField } from './components';\nimport { SIGN_IN_REQUEST_VALIDATOR, validate } from './validators';\nimport { extractErrorMessage, onEnterCallback, updateValue } from './utils';\nimport { AuthenticationContext } from './contexts/authentication';\n\nconst SignIn: FC = () => {\n  const authenticationContext = useContext(AuthenticationContext);\n  const { enqueueSnackbar } = useSnackbar();\n\n  const [signInRequest, setSignInRequest] = useState<SignInRequest>({\n    username: '',\n    password: ''\n  });\n  const [processing, setProcessing] = useState<boolean>(false);\n  const [fieldErrors, setFieldErrors] = useState<ValidateFieldsError>();\n\n  const updateLoginRequestValue = updateValue(setSignInRequest);\n\n  const validateAndSignIn = async () => {\n    setProcessing(true);\n    try {\n      await validate(SIGN_IN_REQUEST_VALIDATOR, signInRequest);\n      signIn();\n    } catch (errors: any) {\n      setFieldErrors(errors);\n      setProcessing(false);\n    }\n  };\n\n  const signIn = async () => {\n    try {\n      const { data: loginResponse } = await AuthenticationApi.signIn(signInRequest);\n      authenticationContext.signIn(loginResponse.access_token);\n    } catch (error: any) {\n      if (error.response?.status === 401) {\n        enqueueSnackbar(\"Invalid login details\", { variant: \"warning\" });\n      } else {\n        enqueueSnackbar(extractErrorMessage(error, \"Unexpected error, please try again\"), { variant: \"error\" });\n      }\n      setProcessing(false);\n    }\n  };\n\n  const submitOnEnter = onEnterCallback(signIn);\n\n  return (\n    <Box\n      display=\"flex\"\n      height=\"100vh\"\n      margin=\"auto\"\n      padding={2}\n      justifyContent=\"center\"\n      flexDirection=\"column\"\n      maxWidth={(theme) => theme.breakpoints.values.sm}\n    >\n      <Paper\n        sx={(theme) => ({\n          textAlign: \"center\",\n          padding: theme.spacing(2),\n          paddingTop: \"200px\",\n          backgroundImage: 'url(\"/app/icon.png\")',\n          backgroundRepeat: \"no-repeat\",\n          backgroundPosition: \"50% \" + theme.spacing(2),\n          backgroundSize: \"auto 150px\",\n          width: \"100%\"\n        })}\n      >\n        <Typography variant=\"h4\">{PROJECT_NAME}</Typography>\n        <ValidatedTextField\n          fieldErrors={fieldErrors}\n          disabled={processing}\n          name=\"username\"\n          label=\"Username\"\n          value={signInRequest.username}\n          onChange={updateLoginRequestValue}\n          margin=\"normal\"\n          variant=\"outlined\"\n          fullWidth\n        />\n        <ValidatedTextField\n          fieldErrors={fieldErrors}\n          disabled={processing}\n          type=\"password\"\n          name=\"password\"\n          label=\"Password\"\n          value={signInRequest.password}\n          onChange={updateLoginRequestValue}\n          onKeyDown={submitOnEnter}\n          margin=\"normal\"\n          variant=\"outlined\"\n          fullWidth\n        />\n        <Fab variant=\"extended\" color=\"primary\" sx={{ mt: 2 }} onClick={validateAndSignIn} disabled={processing}>\n          <ForwardIcon sx={{ mr: 1 }} />\n          Sign In\n        </Fab>\n      </Paper>\n    </Box>\n  );\n};\n\nexport default SignIn;\n"]},"metadata":{},"sourceType":"module"}