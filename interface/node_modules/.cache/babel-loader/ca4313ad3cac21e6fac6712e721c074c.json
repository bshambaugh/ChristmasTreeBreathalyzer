{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import React,{useContext,useState}from'react';import{Button}from'@mui/material';import SaveIcon from'@mui/icons-material/Save';import*as SecurityApi from\"../../api/security\";import{ButtonRow,FormLoader,MessageBox,SectionContent,ValidatedPasswordField}from'../../components';import{SECURITY_SETTINGS_VALIDATOR,validate}from'../../validators';import{updateValue,useRest}from'../../utils';import{AuthenticatedContext}from'../../contexts/authentication';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SecuritySettingsForm=function SecuritySettingsForm(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),fieldErrors=_useState2[0],setFieldErrors=_useState2[1];var _useRest=useRest({read:SecurityApi.readSecuritySettings,update:SecurityApi.updateSecuritySettings}),loadData=_useRest.loadData,saving=_useRest.saving,data=_useRest.data,setData=_useRest.setData,saveData=_useRest.saveData,errorMessage=_useRest.errorMessage;var authenticatedContext=useContext(AuthenticatedContext);var updateFormValue=updateValue(setData);var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}var validateAndSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setFieldErrors(undefined);_context.next=4;return validate(SECURITY_SETTINGS_VALIDATOR,data);case 4:_context.next=6;return saveData();case 6:_context.next=8;return authenticatedContext.refresh();case 8:_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);setFieldErrors(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function validateAndSubmit(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ValidatedPasswordField,{fieldErrors:fieldErrors,name:\"jwt_secret\",label:\"JWT Secret\",fullWidth:true,variant:\"outlined\",value:data.jwt_secret,onChange:updateFormValue,margin:\"normal\"}),/*#__PURE__*/_jsx(MessageBox,{level:\"info\",message:\"The JWT secret is used to sign authentication tokens. If you modify the JWT Secret, all users will be signed out.\",mt:1}),/*#__PURE__*/_jsx(ButtonRow,{mt:2,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),disabled:saving,variant:\"contained\",color:\"primary\",type:\"submit\",onClick:validateAndSubmit,children:\"Save\"})})]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"Security Settings\",titleGutter:true,children:content()});};export default SecuritySettingsForm;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/security/SecuritySettingsForm.tsx"],"names":["React","useContext","useState","Button","SaveIcon","SecurityApi","ButtonRow","FormLoader","MessageBox","SectionContent","ValidatedPasswordField","SECURITY_SETTINGS_VALIDATOR","validate","updateValue","useRest","AuthenticatedContext","SecuritySettingsForm","fieldErrors","setFieldErrors","read","readSecuritySettings","update","updateSecuritySettings","loadData","saving","data","setData","saveData","errorMessage","authenticatedContext","updateFormValue","content","validateAndSubmit","undefined","refresh","jwt_secret"],"mappings":"wcAAA,MAAOA,CAAAA,KAAP,EAAoBC,UAApB,CAAgCC,QAAhC,KAAgD,OAAhD,CAGA,OAASC,MAAT,KAAuB,eAAvB,CACA,MAAOC,CAAAA,QAAP,KAAqB,0BAArB,CAEA,MAAO,GAAKC,CAAAA,WAAZ,KAA6B,oBAA7B,CAEA,OAASC,SAAT,CAAoBC,UAApB,CAAgCC,UAAhC,CAA4CC,cAA5C,CAA4DC,sBAA5D,KAA0F,kBAA1F,CACA,OAASC,2BAAT,CAAsCC,QAAtC,KAAsD,kBAAtD,CACA,OAASC,WAAT,CAAsBC,OAAtB,KAAqC,aAArC,CACA,OAASC,oBAAT,KAAqC,+BAArC,C,6IAEA,GAAMC,CAAAA,oBAAwB,CAAG,QAA3BA,CAAAA,oBAA2B,EAAM,CACrC,cAAsCd,QAAQ,EAA9C,wCAAOe,WAAP,eAAoBC,cAApB,eACA,aAEIJ,OAAO,CAAmB,CAAEK,IAAI,CAAEd,WAAW,CAACe,oBAApB,CAA0CC,MAAM,CAAEhB,WAAW,CAACiB,sBAA9D,CAAnB,CAFX,CACEC,QADF,UACEA,QADF,CACYC,MADZ,UACYA,MADZ,CACoBC,IADpB,UACoBA,IADpB,CAC0BC,OAD1B,UAC0BA,OAD1B,CACmCC,QADnC,UACmCA,QADnC,CAC6CC,YAD7C,UAC6CA,YAD7C,CAIA,GAAMC,CAAAA,oBAAoB,CAAG5B,UAAU,CAACc,oBAAD,CAAvC,CACA,GAAMe,CAAAA,eAAe,CAAGjB,WAAW,CAACa,OAAD,CAAnC,CAEA,GAAMK,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpB,GAAI,CAACN,IAAL,CAAW,CACT,mBAAQ,KAAC,UAAD,EAAY,OAAO,CAAEF,QAArB,CAA+B,YAAY,CAAEK,YAA7C,EAAR,CACD,CAED,GAAMI,CAAAA,iBAAiB,0FAAG,mJAEtBd,cAAc,CAACe,SAAD,CAAd,CAFsB,sBAGhBrB,CAAAA,QAAQ,CAACD,2BAAD,CAA8Bc,IAA9B,CAHQ,8BAIhBE,CAAAA,QAAQ,EAJQ,8BAKhBE,CAAAA,oBAAoB,CAACK,OAArB,EALgB,yFAOtBhB,cAAc,aAAd,CAPsB,qEAAH,kBAAjBc,CAAAA,iBAAiB,0CAAvB,CAWA,mBACE,wCACE,KAAC,sBAAD,EACE,WAAW,CAAEf,WADf,CAEE,IAAI,CAAC,YAFP,CAGE,KAAK,CAAC,YAHR,CAIE,SAAS,KAJX,CAKE,OAAO,CAAC,UALV,CAME,KAAK,CAAEQ,IAAI,CAACU,UANd,CAOE,QAAQ,CAAEL,eAPZ,CAQE,MAAM,CAAC,QART,EADF,cAWE,KAAC,UAAD,EACE,KAAK,CAAC,MADR,CAEE,OAAO,CAAC,mHAFV,CAGE,EAAE,CAAE,CAHN,EAXF,cAgBE,KAAC,SAAD,EAAW,EAAE,CAAE,CAAf,uBACE,KAAC,MAAD,EAAQ,SAAS,cAAE,KAAC,QAAD,IAAnB,CAAiC,QAAQ,CAAEN,MAA3C,CAAmD,OAAO,CAAC,WAA3D,CAAuE,KAAK,CAAC,SAA7E,CAAuF,IAAI,CAAC,QAA5F,CAAqG,OAAO,CAAEQ,iBAA9G,kBADF,EAhBF,GADF,CAwBD,CAxCD,CA0CA,mBACE,KAAC,cAAD,EAAgB,KAAK,CAAC,mBAAtB,CAA0C,WAAW,KAArD,UACGD,OAAO,EADV,EADF,CAKD,CAxDD,CA0DA,cAAef,CAAAA,oBAAf","sourcesContent":["import React, { FC, useContext, useState } from 'react';\nimport { ValidateFieldsError } from 'async-validator';\n\nimport { Button } from '@mui/material';\nimport SaveIcon from '@mui/icons-material/Save';\n\nimport * as SecurityApi from \"../../api/security\";\nimport { SecuritySettings } from '../../types';\nimport { ButtonRow, FormLoader, MessageBox, SectionContent, ValidatedPasswordField } from '../../components';\nimport { SECURITY_SETTINGS_VALIDATOR, validate } from '../../validators';\nimport { updateValue, useRest } from '../../utils';\nimport { AuthenticatedContext } from '../../contexts/authentication';\n\nconst SecuritySettingsForm: FC = () => {\n  const [fieldErrors, setFieldErrors] = useState<ValidateFieldsError>();\n  const {\n    loadData, saving, data, setData, saveData, errorMessage\n  } = useRest<SecuritySettings>({ read: SecurityApi.readSecuritySettings, update: SecurityApi.updateSecuritySettings });\n\n  const authenticatedContext = useContext(AuthenticatedContext);\n  const updateFormValue = updateValue(setData);\n\n  const content = () => {\n    if (!data) {\n      return (<FormLoader onRetry={loadData} errorMessage={errorMessage} />);\n    }\n\n    const validateAndSubmit = async () => {\n      try {\n        setFieldErrors(undefined);\n        await validate(SECURITY_SETTINGS_VALIDATOR, data);\n        await saveData();\n        await authenticatedContext.refresh();\n      } catch (errors: any) {\n        setFieldErrors(errors);\n      }\n    };\n\n    return (\n      <>\n        <ValidatedPasswordField\n          fieldErrors={fieldErrors}\n          name=\"jwt_secret\"\n          label=\"JWT Secret\"\n          fullWidth\n          variant=\"outlined\"\n          value={data.jwt_secret}\n          onChange={updateFormValue}\n          margin=\"normal\"\n        />\n        <MessageBox\n          level=\"info\"\n          message=\"The JWT secret is used to sign authentication tokens. If you modify the JWT Secret, all users will be signed out.\"\n          mt={1}\n        />\n        <ButtonRow mt={2}>\n          <Button startIcon={<SaveIcon />} disabled={saving} variant=\"contained\" color=\"primary\" type=\"submit\" onClick={validateAndSubmit}>\n            Save\n          </Button>\n        </ButtonRow>\n      </>\n    );\n  };\n\n  return (\n    <SectionContent title='Security Settings' titleGutter>\n      {content()}\n    </SectionContent>\n  );\n};\n\nexport default SecuritySettingsForm;\n"]},"metadata":{},"sourceType":"module"}