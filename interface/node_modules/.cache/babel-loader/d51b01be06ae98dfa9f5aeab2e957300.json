{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect}from'react';import{useRef,useState}from'react';import*as SystemApi from\"../../api/system\";import{FormLoader}from'../../components';import{jsx as _jsx}from\"react/jsx-runtime\";var RESTART_TIMEOUT=2*60*1000;var POLL_TIMEOUT=2000;var POLL_INTERVAL=5000;var FirmwareRestartMonitor=function FirmwareRestartMonitor(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),failed=_useState2[0],setFailed=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),timeoutId=_useState4[0],setTimeoutId=_useState4[1];var timeoutAt=useRef(new Date().getTime()+RESTART_TIMEOUT);var poll=useRef(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return SystemApi.readSystemStatus(POLL_TIMEOUT);case 3:document.location.href=\"/firmwareUpdated\";_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);if(new Date().getTime()<timeoutAt.current){setTimeoutId(setTimeout(poll.current,POLL_INTERVAL));}else{setFailed(true);}case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);})));useEffect(function(){poll.current();},[]);useEffect(function(){return function(){return timeoutId&&clearTimeout(timeoutId);};},[timeoutId]);return/*#__PURE__*/_jsx(FormLoader,{message:\"Device restarting, please wait\\u2026\",errorMessage:failed?\"Timed out waiting for device to restart.\":undefined});};export default FirmwareRestartMonitor;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/system/FirmwareRestartMonitor.tsx"],"names":["useEffect","useRef","useState","SystemApi","FormLoader","RESTART_TIMEOUT","POLL_TIMEOUT","POLL_INTERVAL","FirmwareRestartMonitor","failed","setFailed","timeoutId","setTimeoutId","timeoutAt","Date","getTime","poll","readSystemStatus","document","location","href","current","setTimeout","clearTimeout","undefined"],"mappings":"wcAAA,OAASA,SAAT,KAA0B,OAA1B,CACA,OAAaC,MAAb,CAAqBC,QAArB,KAAqC,OAArC,CAEA,MAAO,GAAKC,CAAAA,SAAZ,KAA2B,kBAA3B,CACA,OAASC,UAAT,KAA2B,kBAA3B,C,2CAEA,GAAMC,CAAAA,eAAe,CAAG,EAAI,EAAJ,CAAS,IAAjC,CACA,GAAMC,CAAAA,YAAY,CAAG,IAArB,CACA,GAAMC,CAAAA,aAAa,CAAG,IAAtB,CAEA,GAAMC,CAAAA,sBAA0B,CAAG,QAA7BA,CAAAA,sBAA6B,EAAM,CAEvC,cAA4BN,QAAQ,CAAU,KAAV,CAApC,wCAAOO,MAAP,eAAeC,SAAf,eACA,eAAkCR,QAAQ,EAA1C,yCAAOS,SAAP,eAAkBC,YAAlB,eAEA,GAAMC,CAAAA,SAAS,CAAGZ,MAAM,CAAC,GAAIa,CAAAA,IAAJ,GAAWC,OAAX,GAAuBV,eAAxB,CAAxB,CACA,GAAMW,CAAAA,IAAI,CAAGf,MAAM,sEAAC,yKAEVE,CAAAA,SAAS,CAACc,gBAAV,CAA2BX,YAA3B,CAFU,QAGhBY,QAAQ,CAACC,QAAT,CAAkBC,IAAlB,CAAyB,kBAAzB,CAHgB,8EAKhB,GAAI,GAAIN,CAAAA,IAAJ,GAAWC,OAAX,GAAuBF,SAAS,CAACQ,OAArC,CAA8C,CAC5CT,YAAY,CAACU,UAAU,CAACN,IAAI,CAACK,OAAN,CAAed,aAAf,CAAX,CAAZ,CACD,CAFD,IAEO,CACLG,SAAS,CAAC,IAAD,CAAT,CACD,CATe,mEAAD,GAAnB,CAaAV,SAAS,CACP,UAAM,CACJgB,IAAI,CAACK,OAAL,GACD,CAHM,CAIP,EAJO,CAAT,CAOArB,SAAS,CAAC,iBAAM,kBAAMW,CAAAA,SAAS,EAAIY,YAAY,CAACZ,SAAD,CAA/B,EAAN,EAAD,CAAmD,CAACA,SAAD,CAAnD,CAAT,CAEA,mBACE,KAAC,UAAD,EACE,OAAO,CAAC,sCADV,CAEE,YAAY,CAAEF,MAAM,CAAG,0CAAH,CAAgDe,SAFtE,EADF,CAOD,CAnCD,CAqCA,cAAehB,CAAAA,sBAAf","sourcesContent":["import { useEffect } from 'react';\nimport { FC, useRef, useState } from 'react';\n\nimport * as SystemApi from \"../../api/system\";\nimport { FormLoader } from '../../components';\n\nconst RESTART_TIMEOUT = 2 * 60 * 1000;\nconst POLL_TIMEOUT = 2000;\nconst POLL_INTERVAL = 5000;\n\nconst FirmwareRestartMonitor: FC = () => {\n\n  const [failed, setFailed] = useState<boolean>(false);\n  const [timeoutId, setTimeoutId] = useState<NodeJS.Timeout>();\n\n  const timeoutAt = useRef(new Date().getTime() + RESTART_TIMEOUT);\n  const poll = useRef(async () => {\n    try {\n      await SystemApi.readSystemStatus(POLL_TIMEOUT);\n      document.location.href = \"/firmwareUpdated\";\n    } catch (error: any) {\n      if (new Date().getTime() < timeoutAt.current) {\n        setTimeoutId(setTimeout(poll.current, POLL_INTERVAL));\n      } else {\n        setFailed(true);\n      }\n    }\n  });\n\n  useEffect(\n    () => {\n      poll.current();\n    },\n    []\n  );\n\n  useEffect(() => () => timeoutId && clearTimeout(timeoutId), [timeoutId]);\n\n  return (\n    <FormLoader\n      message=\"Device restarting, please wait&hellip;\"\n      errorMessage={failed ? \"Timed out waiting for device to restart.\" : undefined}\n    />\n  );\n\n};\n\nexport default FirmwareRestartMonitor;\n"]},"metadata":{},"sourceType":"module"}