{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect}from'react';import{useRef,useState}from'react';import*as SystemApi from\"../../api/system\";import{FormLoader}from'../../components';import{jsx as _jsx}from\"react/jsx-runtime\";var RESTART_TIMEOUT=2*60*1000;var POLL_TIMEOUT=2000;var POLL_INTERVAL=5000;var FirmwareRestartMonitor=function FirmwareRestartMonitor(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),failed=_useState2[0],setFailed=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),timeoutId=_useState4[0],setTimeoutId=_useState4[1];var timeoutAt=useRef(new Date().getTime()+RESTART_TIMEOUT);var poll=useRef(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return SystemApi.readSystemStatus(POLL_TIMEOUT);case 3:document.location.href=\"/firmwareUpdated\";_context.next=9;break;case 6:_context.prev=6;_context.t0=_context[\"catch\"](0);if(new Date().getTime()<timeoutAt.current){setTimeoutId(setTimeout(poll.current,POLL_INTERVAL));}else{setFailed(true);}case 9:case\"end\":return _context.stop();}}},_callee,null,[[0,6]]);})));useEffect(function(){poll.current();},[]);useEffect(function(){return function(){return timeoutId&&clearTimeout(timeoutId);};},[timeoutId]);return/*#__PURE__*/_jsx(FormLoader,{message:\"Device restarting, please wait\\u2026\",errorMessage:failed?\"Timed out waiting for device to restart.\":undefined});};export default FirmwareRestartMonitor;","map":null,"metadata":{},"sourceType":"module"}