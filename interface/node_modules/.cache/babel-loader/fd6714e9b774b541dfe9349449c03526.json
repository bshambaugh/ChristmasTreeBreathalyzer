{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from\"react\";import{useSnackbar}from\"notistack\";import{Avatar,Box,Button,Dialog,DialogActions,DialogContent,DialogTitle,Divider,List,ListItem,ListItemAvatar,ListItemText}from\"@mui/material\";import DevicesIcon from'@mui/icons-material/Devices';import ShowChartIcon from'@mui/icons-material/ShowChart';import MemoryIcon from'@mui/icons-material/Memory';import AppsIcon from'@mui/icons-material/Apps';import DataUsageIcon from'@mui/icons-material/DataUsage';import SdStorageIcon from'@mui/icons-material/SdStorage';import FolderIcon from'@mui/icons-material/Folder';import RefreshIcon from'@mui/icons-material/Refresh';import PowerSettingsNewIcon from'@mui/icons-material/PowerSettingsNew';import SettingsBackupRestoreIcon from'@mui/icons-material/SettingsBackupRestore';import*as SystemApi from\"../../api/system\";import{EspPlatform}from\"../../types\";import{ButtonRow,FormLoader,SectionContent}from\"../../components\";import{extractErrorMessage,useRest}from\"../../utils\";import{AuthenticatedContext}from\"../../contexts/authentication\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function formatNumber(num){return new Intl.NumberFormat().format(num);}var SystemStatusForm=function SystemStatusForm(){var _useRest=useRest({read:SystemApi.readSystemStatus}),loadData=_useRest.loadData,data=_useRest.data,errorMessage=_useRest.errorMessage;var _useContext=useContext(AuthenticatedContext),me=_useContext.me;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),confirmRestart=_useState2[0],setConfirmRestart=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),confirmFactoryReset=_useState4[0],setConfirmFactoryReset=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var restart=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return SystemApi.restart();case 4:enqueueSnackbar(\"Device is restarting\",{variant:'info'});_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context.t0,'Problem restarting device'),{variant:'error'});case 10:_context.prev=10;setConfirmRestart(false);setProcessing(false);return _context.finish(10);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,7,10,14]]);}));return function restart(){return _ref.apply(this,arguments);};}();var renderRestartDialog=function renderRestartDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:confirmRestart,onClose:function onClose(){return setConfirmRestart(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Restart\"}),/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:\"Are you sure you want to restart the device?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setConfirmRestart(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PowerSettingsNewIcon,{}),variant:\"contained\",onClick:restart,disabled:processing,color:\"primary\",autoFocus:true,children:\"Restart\"})]})]});};var factoryReset=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setProcessing(true);_context2.prev=1;_context2.next=4;return SystemApi.factoryReset();case 4:enqueueSnackbar(\"Device has been factory reset and will now restart\",{variant:'info'});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context2.t0,'Problem factory resetting the device'),{variant:'error'});case 10:_context2.prev=10;setConfirmFactoryReset(false);setProcessing(false);return _context2.finish(10);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7,10,14]]);}));return function factoryReset(){return _ref2.apply(this,arguments);};}();var renderFactoryResetDialog=function renderFactoryResetDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:confirmFactoryReset,onClose:function onClose(){return setConfirmFactoryReset(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Factory Reset\"}),/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:\"Are you sure you want to reset the device to its factory defaults?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setConfirmFactoryReset(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SettingsBackupRestoreIcon,{}),variant:\"contained\",onClick:factoryReset,disabled:processing,autoFocus:true,color:\"error\",children:\"Factory Reset\"})]})]});};var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DevicesIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Device (Platform / SDK)\",secondary:data.esp_platform+' / '+data.sdk_version})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(ShowChartIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"CPU Frequency\",secondary:data.cpu_freq_mhz+' MHz'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(MemoryIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Heap (Free / Max Alloc)\",secondary:formatNumber(data.free_heap)+' / '+formatNumber(data.max_alloc_heap)+' bytes '+(data.esp_platform===EspPlatform.ESP8266?'('+data.heap_fragmentation+'% fragmentation)':'')})]}),data.esp_platform===EspPlatform.ESP32&&data.psram_size>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AppsIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"PSRAM (Size / Free)\",secondary:formatNumber(data.psram_size)+' / '+formatNumber(data.free_psram)+' bytes'})]})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DataUsageIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Sketch (Size / Free)\",secondary:formatNumber(data.sketch_size)+' / '+formatNumber(data.free_sketch_space)+' bytes'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(SdStorageIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Flash Chip (Size / Speed)\",secondary:formatNumber(data.flash_chip_size)+' bytes / '+(data.flash_chip_speed/1000000).toFixed(0)+' MHz'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(FolderIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"File System (Used / Total)\",secondary:formatNumber(data.fs_used)+' / '+formatNumber(data.fs_total)+' bytes ('+formatNumber(data.fs_total-data.fs_used)+'\\xa0bytes free)'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexWrap:\"wrap\",children:[/*#__PURE__*/_jsx(Box,{flexGrow:1,children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(RefreshIcon,{}),variant:\"contained\",color:\"secondary\",onClick:loadData,children:\"Refresh\"})})}),me.admin&&/*#__PURE__*/_jsx(Box,{flexWrap:\"nowrap\",whiteSpace:\"nowrap\",children:/*#__PURE__*/_jsxs(ButtonRow,{mt:1,children:[/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PowerSettingsNewIcon,{}),variant:\"contained\",color:\"primary\",onClick:function onClick(){return setConfirmRestart(true);},children:\"Restart\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SettingsBackupRestoreIcon,{}),variant:\"contained\",onClick:function onClick(){return setConfirmFactoryReset(true);},color:\"error\",children:\"Factory reset\"})]})})]}),renderRestartDialog(),renderFactoryResetDialog()]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"System Status\",titleGutter:true,children:content()});};export default SystemStatusForm;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/system/SystemStatusForm.tsx"],"names":["useContext","useState","useSnackbar","Avatar","Box","Button","Dialog","DialogActions","DialogContent","DialogTitle","Divider","List","ListItem","ListItemAvatar","ListItemText","DevicesIcon","ShowChartIcon","MemoryIcon","AppsIcon","DataUsageIcon","SdStorageIcon","FolderIcon","RefreshIcon","PowerSettingsNewIcon","SettingsBackupRestoreIcon","SystemApi","EspPlatform","ButtonRow","FormLoader","SectionContent","extractErrorMessage","useRest","AuthenticatedContext","formatNumber","num","Intl","NumberFormat","format","SystemStatusForm","read","readSystemStatus","loadData","data","errorMessage","me","confirmRestart","setConfirmRestart","confirmFactoryReset","setConfirmFactoryReset","processing","setProcessing","enqueueSnackbar","restart","variant","renderRestartDialog","factoryReset","renderFactoryResetDialog","content","esp_platform","sdk_version","cpu_freq_mhz","free_heap","max_alloc_heap","ESP8266","heap_fragmentation","ESP32","psram_size","free_psram","sketch_size","free_sketch_space","flash_chip_size","flash_chip_speed","toFixed","fs_used","fs_total","admin"],"mappings":"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","sourcesContent":["import { FC, useContext, useState } from \"react\";\nimport { useSnackbar } from \"notistack\";\n\nimport {\n  Avatar, Box, Button, Dialog, DialogActions, DialogContent, DialogTitle,\n  Divider, List, ListItem, ListItemAvatar, ListItemText\n} from \"@mui/material\";\nimport DevicesIcon from '@mui/icons-material/Devices';\nimport ShowChartIcon from '@mui/icons-material/ShowChart';\nimport MemoryIcon from '@mui/icons-material/Memory';\nimport AppsIcon from '@mui/icons-material/Apps';\nimport DataUsageIcon from '@mui/icons-material/DataUsage';\nimport SdStorageIcon from '@mui/icons-material/SdStorage';\nimport FolderIcon from '@mui/icons-material/Folder';\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport PowerSettingsNewIcon from '@mui/icons-material/PowerSettingsNew';\nimport SettingsBackupRestoreIcon from '@mui/icons-material/SettingsBackupRestore';\n\nimport * as SystemApi from \"../../api/system\";\nimport { EspPlatform, SystemStatus } from \"../../types\";\nimport { ButtonRow, FormLoader, SectionContent } from \"../../components\";\nimport { extractErrorMessage, useRest } from \"../../utils\";\nimport { AuthenticatedContext } from \"../../contexts/authentication\";\n\nfunction formatNumber(num: number) {\n  return new Intl.NumberFormat().format(num);\n}\n\nconst SystemStatusForm: FC = () => {\n  const {\n    loadData, data, errorMessage\n  } = useRest<SystemStatus>({ read: SystemApi.readSystemStatus });\n\n  const { me } = useContext(AuthenticatedContext);\n  const [confirmRestart, setConfirmRestart] = useState<boolean>(false);\n  const [confirmFactoryReset, setConfirmFactoryReset] = useState<boolean>(false);\n  const [processing, setProcessing] = useState<boolean>(false);\n  const { enqueueSnackbar } = useSnackbar();\n\n  const restart = async () => {\n    setProcessing(true);\n    try {\n      await SystemApi.restart();\n      enqueueSnackbar(\"Device is restarting\", { variant: 'info' });\n    } catch (error: any) {\n      enqueueSnackbar(extractErrorMessage(error, 'Problem restarting device'), { variant: 'error' });\n    } finally {\n      setConfirmRestart(false);\n      setProcessing(false);\n    }\n  };\n\n  const renderRestartDialog = () => (\n    <Dialog\n      open={confirmRestart}\n      onClose={() => setConfirmRestart(false)}\n    >\n      <DialogTitle>Confirm Restart</DialogTitle>\n      <DialogContent dividers>\n        Are you sure you want to restart the device?\n      </DialogContent>\n      <DialogActions>\n        <Button variant=\"contained\" onClick={() => setConfirmRestart(false)} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button\n          startIcon={<PowerSettingsNewIcon />}\n          variant=\"contained\"\n          onClick={restart}\n          disabled={processing}\n          color=\"primary\"\n          autoFocus\n        >\n          Restart\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n\n  const factoryReset = async () => {\n    setProcessing(true);\n    try {\n      await SystemApi.factoryReset();\n      enqueueSnackbar(\"Device has been factory reset and will now restart\", { variant: 'info' });\n    } catch (error: any) {\n      enqueueSnackbar(extractErrorMessage(error, 'Problem factory resetting the device'), { variant: 'error' });\n    } finally {\n      setConfirmFactoryReset(false);\n      setProcessing(false);\n    }\n  };\n\n  const renderFactoryResetDialog = () => (\n    <Dialog\n      open={confirmFactoryReset}\n      onClose={() => setConfirmFactoryReset(false)}\n    >\n      <DialogTitle>Confirm Factory Reset</DialogTitle>\n      <DialogContent dividers>\n        Are you sure you want to reset the device to its factory defaults?\n      </DialogContent>\n      <DialogActions>\n        <Button variant=\"contained\" onClick={() => setConfirmFactoryReset(false)} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button\n          startIcon={<SettingsBackupRestoreIcon />}\n          variant=\"contained\"\n          onClick={factoryReset}\n          disabled={processing}\n          autoFocus\n          color=\"error\"\n        >\n          Factory Reset\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n\n  const content = () => {\n    if (!data) {\n      return (<FormLoader onRetry={loadData} errorMessage={errorMessage} />);\n    }\n\n    return (\n      <>\n        <List>\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <DevicesIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Device (Platform / SDK)\" secondary={data.esp_platform + ' / ' + data.sdk_version} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem >\n            <ListItemAvatar>\n              <Avatar>\n                <ShowChartIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"CPU Frequency\" secondary={data.cpu_freq_mhz + ' MHz'} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem >\n            <ListItemAvatar>\n              <Avatar>\n                <MemoryIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText\n              primary=\"Heap (Free / Max Alloc)\"\n              secondary={\n                formatNumber(data.free_heap) +\n                ' / ' +\n                formatNumber(data.max_alloc_heap) +\n                ' bytes ' +\n                (data.esp_platform === EspPlatform.ESP8266 ? '(' + data.heap_fragmentation + '% fragmentation)' : '')\n              }\n            />\n          </ListItem>\n          {\n            (\n              data.esp_platform === EspPlatform.ESP32 && data.psram_size > 0) && (\n              <>\n                <Divider variant=\"inset\" component=\"li\" />\n                <ListItem >\n                  <ListItemAvatar>\n                    <Avatar>\n                      <AppsIcon />\n                    </Avatar>\n                  </ListItemAvatar>\n                  <ListItemText\n                    primary=\"PSRAM (Size / Free)\"\n                    secondary={formatNumber(data.psram_size) + ' / ' + formatNumber(data.free_psram) + ' bytes'}\n                  />\n                </ListItem>\n              </>\n            )\n          }\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem >\n            <ListItemAvatar>\n              <Avatar>\n                <DataUsageIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText\n              primary=\"Sketch (Size / Free)\"\n              secondary={formatNumber(data.sketch_size) + ' / ' + formatNumber(data.free_sketch_space) + ' bytes'}\n            />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem >\n            <ListItemAvatar>\n              <Avatar>\n                <SdStorageIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText\n              primary=\"Flash Chip (Size / Speed)\"\n              secondary={formatNumber(data.flash_chip_size) + ' bytes / ' + (data.flash_chip_speed / 1000000).toFixed(0) + ' MHz'}\n            />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem >\n            <ListItemAvatar>\n              <Avatar>\n                <FolderIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText\n              primary=\"File System (Used / Total)\"\n              secondary={\n                formatNumber(data.fs_used) +\n                ' / ' +\n                formatNumber(data.fs_total) +\n                ' bytes (' + formatNumber(data.fs_total - data.fs_used) + '\\xa0bytes free)'\n              }\n            />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n        </List>\n        <Box display=\"flex\" flexWrap=\"wrap\">\n          <Box flexGrow={1}>\n            <ButtonRow mt={1}>\n              <Button startIcon={<RefreshIcon />} variant=\"contained\" color=\"secondary\" onClick={loadData}>\n                Refresh\n              </Button>\n            </ButtonRow>\n          </Box>\n          {\n            me.admin &&\n            <Box flexWrap=\"nowrap\" whiteSpace=\"nowrap\">\n              <ButtonRow mt={1}>\n                <Button startIcon={<PowerSettingsNewIcon />} variant=\"contained\" color=\"primary\" onClick={() => setConfirmRestart(true)}>\n                  Restart\n                </Button>\n                <Button\n                  startIcon={<SettingsBackupRestoreIcon />}\n                  variant=\"contained\"\n                  onClick={() => setConfirmFactoryReset(true)}\n                  color=\"error\"\n                >\n                  Factory reset\n                </Button>\n              </ButtonRow>\n            </Box>\n          }\n        </Box>\n        {renderRestartDialog()}\n        {renderFactoryResetDialog()}\n      </>\n    );\n  };\n\n  return (\n    <SectionContent title='System Status' titleGutter>\n      {content()}\n    </SectionContent>\n  );\n\n};\n\nexport default SystemStatusForm;\n"]},"metadata":{},"sourceType":"module"}