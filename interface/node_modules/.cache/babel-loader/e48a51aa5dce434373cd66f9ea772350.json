{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useState}from'react';import{range}from'lodash';import{Button,Checkbox,MenuItem}from'@mui/material';import SaveIcon from'@mui/icons-material/Save';import*as APApi from\"../../api/ap\";import{APProvisionMode}from'../../types';import{BlockFormControlLabel,ButtonRow,FormLoader,SectionContent,ValidatedPasswordField,ValidatedTextField}from'../../components';import{createAPSettingsValidator,validate}from'../../validators';import{numberValue,updateValue,useRest}from'../../utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var isAPEnabled=function isAPEnabled(_ref){var provision_mode=_ref.provision_mode;return provision_mode===APProvisionMode.AP_MODE_ALWAYS||provision_mode===APProvisionMode.AP_MODE_DISCONNECTED;};var APSettingsForm=function APSettingsForm(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),fieldErrors=_useState2[0],setFieldErrors=_useState2[1];var _useRest=useRest({read:APApi.readAPSettings,update:APApi.updateAPSettings}),loadData=_useRest.loadData,saving=_useRest.saving,data=_useRest.data,setData=_useRest.setData,saveData=_useRest.saveData,errorMessage=_useRest.errorMessage;var updateFormValue=updateValue(setData);var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}var validateAndSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setFieldErrors(undefined);_context.next=4;return validate(createAPSettingsValidator(data),data);case 4:saveData();_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);setFieldErrors(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function validateAndSubmit(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ValidatedTextField,{fieldErrors:fieldErrors,name:\"provision_mode\",label:\"Provide Access Point\\u2026\",value:data.provision_mode,fullWidth:true,select:true,variant:\"outlined\",onChange:updateFormValue,margin:\"normal\",children:[/*#__PURE__*/_jsx(MenuItem,{value:APProvisionMode.AP_MODE_ALWAYS,children:\"Always\"}),/*#__PURE__*/_jsx(MenuItem,{value:APProvisionMode.AP_MODE_DISCONNECTED,children:\"When WiFi Disconnected\"}),/*#__PURE__*/_jsx(MenuItem,{value:APProvisionMode.AP_NEVER,children:\"Never\"})]}),isAPEnabled(data)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"ssid\",label:\"Access Point SSID\",fullWidth:true,variant:\"outlined\",value:data.ssid,onChange:updateFormValue,margin:\"normal\"}),/*#__PURE__*/_jsx(ValidatedPasswordField,{fieldErrors:fieldErrors,name:\"password\",label:\"Access Point Password\",fullWidth:true,variant:\"outlined\",value:data.password,onChange:updateFormValue,margin:\"normal\"}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"channel\",label:\"Preferred Channel\",value:numberValue(data.channel),fullWidth:true,select:true,type:\"number\",variant:\"outlined\",onChange:updateFormValue,margin:\"normal\",children:range(1,14).map(function(i){return/*#__PURE__*/_jsx(MenuItem,{value:i,children:i},i);})}),/*#__PURE__*/_jsx(BlockFormControlLabel,{control:/*#__PURE__*/_jsx(Checkbox,{name:\"ssid_hidden\",checked:data.ssid_hidden,onChange:updateFormValue}),label:\"Hide SSID?\"}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"max_clients\",label:\"Max Clients\",value:numberValue(data.max_clients),fullWidth:true,select:true,type:\"number\",variant:\"outlined\",onChange:updateFormValue,margin:\"normal\",children:range(1,9).map(function(i){return/*#__PURE__*/_jsx(MenuItem,{value:i,children:i},i);})}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"local_ip\",label:\"Local IP\",fullWidth:true,variant:\"outlined\",value:data.local_ip,onChange:updateFormValue,margin:\"normal\"}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"gateway_ip\",label:\"Gateway\",fullWidth:true,variant:\"outlined\",value:data.gateway_ip,onChange:updateFormValue,margin:\"normal\"}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,name:\"subnet_mask\",label:\"Subnet\",fullWidth:true,variant:\"outlined\",value:data.subnet_mask,onChange:updateFormValue,margin:\"normal\"})]}),/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),disabled:saving,variant:\"contained\",color:\"primary\",type:\"submit\",onClick:validateAndSubmit,children:\"Save\"})})]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"Access Point Settings\",titleGutter:true,children:content()});};export default APSettingsForm;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/ap/APSettingsForm.tsx"],"names":["useState","range","Button","Checkbox","MenuItem","SaveIcon","APApi","APProvisionMode","BlockFormControlLabel","ButtonRow","FormLoader","SectionContent","ValidatedPasswordField","ValidatedTextField","createAPSettingsValidator","validate","numberValue","updateValue","useRest","isAPEnabled","provision_mode","AP_MODE_ALWAYS","AP_MODE_DISCONNECTED","APSettingsForm","fieldErrors","setFieldErrors","read","readAPSettings","update","updateAPSettings","loadData","saving","data","setData","saveData","errorMessage","updateFormValue","content","validateAndSubmit","undefined","AP_NEVER","ssid","password","channel","map","i","ssid_hidden","max_clients","local_ip","gateway_ip","subnet_mask"],"mappings":"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","sourcesContent":["import { FC, useState } from 'react';\nimport { ValidateFieldsError } from 'async-validator';\nimport { range } from 'lodash';\n\nimport { Button, Checkbox, MenuItem } from '@mui/material';\nimport SaveIcon from '@mui/icons-material/Save';\n\nimport * as APApi from \"../../api/ap\";\nimport { APProvisionMode, APSettings } from '../../types';\nimport { BlockFormControlLabel, ButtonRow, FormLoader, SectionContent, ValidatedPasswordField, ValidatedTextField } from '../../components';\nimport { createAPSettingsValidator, validate } from '../../validators';\nimport { numberValue, updateValue, useRest } from '../../utils';\n\nexport const isAPEnabled = ({ provision_mode }: APSettings) => {\n  return provision_mode === APProvisionMode.AP_MODE_ALWAYS || provision_mode === APProvisionMode.AP_MODE_DISCONNECTED;\n};\n\nconst APSettingsForm: FC = () => {\n  const [fieldErrors, setFieldErrors] = useState<ValidateFieldsError>();\n  const {\n    loadData, saving, data, setData, saveData, errorMessage\n  } = useRest<APSettings>({ read: APApi.readAPSettings, update: APApi.updateAPSettings });\n\n  const updateFormValue = updateValue(setData);\n\n  const content = () => {\n    if (!data) {\n      return (<FormLoader onRetry={loadData} errorMessage={errorMessage} />);\n    }\n\n    const validateAndSubmit = async () => {\n      try {\n        setFieldErrors(undefined);\n        await validate(createAPSettingsValidator(data), data);\n        saveData();\n      } catch (errors: any) {\n        setFieldErrors(errors);\n      }\n    };\n\n    return (\n      <>\n        <ValidatedTextField\n          fieldErrors={fieldErrors}\n          name=\"provision_mode\"\n          label=\"Provide Access Point&hellip;\"\n          value={data.provision_mode}\n          fullWidth\n          select\n          variant=\"outlined\"\n          onChange={updateFormValue}\n          margin=\"normal\"\n        >\n          <MenuItem value={APProvisionMode.AP_MODE_ALWAYS}>Always</MenuItem>\n          <MenuItem value={APProvisionMode.AP_MODE_DISCONNECTED}>When WiFi Disconnected</MenuItem>\n          <MenuItem value={APProvisionMode.AP_NEVER}>Never</MenuItem>\n        </ValidatedTextField>\n        {\n          isAPEnabled(data) &&\n          <>\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"ssid\"\n              label=\"Access Point SSID\"\n              fullWidth\n              variant=\"outlined\"\n              value={data.ssid}\n              onChange={updateFormValue}\n              margin=\"normal\"\n            />\n            <ValidatedPasswordField\n              fieldErrors={fieldErrors}\n              name=\"password\"\n              label=\"Access Point Password\"\n              fullWidth\n              variant=\"outlined\"\n              value={data.password}\n              onChange={updateFormValue}\n              margin=\"normal\"\n            />\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"channel\"\n              label=\"Preferred Channel\"\n              value={numberValue(data.channel)}\n              fullWidth\n              select\n              type=\"number\"\n              variant=\"outlined\"\n              onChange={updateFormValue}\n              margin=\"normal\"\n            >\n              {\n                range(1, 14).map((i) => <MenuItem key={i} value={i}>{i}</MenuItem>)\n              }\n            </ValidatedTextField>\n            <BlockFormControlLabel\n              control={\n                <Checkbox\n                  name=\"ssid_hidden\"\n                  checked={data.ssid_hidden}\n                  onChange={updateFormValue}\n                />\n              }\n              label=\"Hide SSID?\"\n            />\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"max_clients\"\n              label=\"Max Clients\"\n              value={numberValue(data.max_clients)}\n              fullWidth\n              select\n              type=\"number\"\n              variant=\"outlined\"\n              onChange={updateFormValue}\n              margin=\"normal\"\n            >\n              {\n                range(1, 9).map((i) => <MenuItem key={i} value={i}>{i}</MenuItem>)\n              }\n            </ValidatedTextField>\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"local_ip\"\n              label=\"Local IP\"\n              fullWidth\n              variant=\"outlined\"\n              value={data.local_ip}\n              onChange={updateFormValue}\n              margin=\"normal\"\n            />\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"gateway_ip\"\n              label=\"Gateway\"\n              fullWidth\n              variant=\"outlined\"\n              value={data.gateway_ip}\n              onChange={updateFormValue}\n              margin=\"normal\"\n            />\n            <ValidatedTextField\n              fieldErrors={fieldErrors}\n              name=\"subnet_mask\"\n              label=\"Subnet\"\n              fullWidth\n              variant=\"outlined\"\n              value={data.subnet_mask}\n              onChange={updateFormValue}\n              margin=\"normal\"\n            />\n          </>\n        }\n        <ButtonRow mt={1}>\n          <Button startIcon={<SaveIcon />} disabled={saving} variant=\"contained\" color=\"primary\" type=\"submit\" onClick={validateAndSubmit}>\n            Save\n          </Button>\n        </ButtonRow>\n      </>\n    );\n  };\n\n  return (\n    <SectionContent title='Access Point Settings' titleGutter>\n      {content()}\n    </SectionContent>\n  );\n};\n\nexport default APSettingsForm;\n"]},"metadata":{},"sourceType":"module"}