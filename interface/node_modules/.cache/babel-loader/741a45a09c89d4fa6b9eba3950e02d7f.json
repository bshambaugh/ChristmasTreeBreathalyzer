{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useCallback,useEffect,useState}from\"react\";import{useSnackbar}from'notistack';import{extractErrorMessage}from\".\";export var useRest=function useRest(_ref){var read=_ref.read,update=_ref.update;var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),saving=_useState2[0],setSaving=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),errorMessage=_useState6[0],setErrorMessage=_useState6[1];var loadData=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var message;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setData(undefined);setErrorMessage(undefined);_context.prev=2;_context.t0=setData;_context.next=6;return read();case 6:_context.t1=_context.sent.data;(0,_context.t0)(_context.t1);_context.next=15;break;case 10:_context.prev=10;_context.t2=_context[\"catch\"](2);message=extractErrorMessage(_context.t2,'Problem loading data');enqueueSnackbar(message,{variant:'error'});setErrorMessage(message);case 15:case\"end\":return _context.stop();}}},_callee,null,[[2,10]]);})),[read,enqueueSnackbar]);var save=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(toSave){var message;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(update){_context2.next=2;break;}return _context2.abrupt(\"return\");case 2:setSaving(true);setErrorMessage(undefined);_context2.prev=4;_context2.t0=setData;_context2.next=8;return update(toSave);case 8:_context2.t1=_context2.sent.data;(0,_context2.t0)(_context2.t1);enqueueSnackbar(\"Update successful\",{variant:'success'});_context2.next=18;break;case 13:_context2.prev=13;_context2.t2=_context2[\"catch\"](4);message=extractErrorMessage(_context2.t2,'Problem saving data');enqueueSnackbar(message,{variant:'error'});setErrorMessage(message);case 18:_context2.prev=18;setSaving(false);return _context2.finish(18);case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[4,13,18,21]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),[update,enqueueSnackbar]);var saveData=function saveData(){return data&&save(data);};useEffect(function(){loadData();},[loadData]);return{loadData:loadData,saveData:saveData,saving:saving,setData:setData,data:data,errorMessage:errorMessage};};","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/utils/useRest.ts"],"names":["useCallback","useEffect","useState","useSnackbar","extractErrorMessage","useRest","read","update","enqueueSnackbar","saving","setSaving","data","setData","errorMessage","setErrorMessage","loadData","undefined","message","variant","save","toSave","saveData"],"mappings":"wcAAA,OAASA,WAAT,CAAsBC,SAAtB,CAAiCC,QAAjC,KAAiD,OAAjD,CACA,OAASC,WAAT,KAA4B,WAA5B,CAGA,OAASC,mBAAT,KAAoC,GAApC,CAOA,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,MAAgD,IAA1CC,CAAAA,IAA0C,MAA1CA,IAA0C,CAApCC,MAAoC,MAApCA,MAAoC,CACrE,iBAA4BJ,WAAW,EAAvC,CAAQK,eAAR,cAAQA,eAAR,CAEA,cAA4BN,QAAQ,CAAU,KAAV,CAApC,wCAAOO,MAAP,eAAeC,SAAf,eACA,eAAwBR,QAAQ,EAAhC,yCAAOS,IAAP,eAAaC,OAAb,eACA,eAAwCV,QAAQ,EAAhD,yCAAOW,YAAP,eAAqBC,eAArB,eAEA,GAAMC,CAAAA,QAAQ,CAAGf,WAAW,sEAAC,+IAC3BY,OAAO,CAACI,SAAD,CAAP,CACAF,eAAe,CAACE,SAAD,CAAf,CAF2B,4BAIzBJ,OAJyB,uBAIVN,CAAAA,IAAI,EAJM,kCAIFK,IAJE,+GAMnBM,OANmB,CAMTb,mBAAmB,aAAQ,sBAAR,CANV,CAOzBI,eAAe,CAACS,OAAD,CAAU,CAAEC,OAAO,CAAE,OAAX,CAAV,CAAf,CACAJ,eAAe,CAACG,OAAD,CAAf,CARyB,qEAAD,GAUzB,CAACX,IAAD,CAAOE,eAAP,CAVyB,CAA5B,CAYA,GAAMW,CAAAA,IAAI,CAAGnB,WAAW,2FAAC,kBAAOoB,MAAP,qIAClBb,MADkB,mEAIvBG,SAAS,CAAC,IAAD,CAAT,CACAI,eAAe,CAACE,SAAD,CAAf,CALuB,8BAOrBJ,OAPqB,wBAONL,CAAAA,MAAM,CAACa,MAAD,CAPA,oCAOUT,IAPV,gCAQrBH,eAAe,CAAC,mBAAD,CAAsB,CAAEU,OAAO,CAAE,SAAX,CAAtB,CAAf,CARqB,qFAUfD,OAVe,CAULb,mBAAmB,cAAQ,qBAAR,CAVd,CAWrBI,eAAe,CAACS,OAAD,CAAU,CAAEC,OAAO,CAAE,OAAX,CAAV,CAAf,CACAJ,eAAe,CAACG,OAAD,CAAf,CAZqB,0BAcrBP,SAAS,CAAC,KAAD,CAAT,CAdqB,yGAAD,gEAgBrB,CAACH,MAAD,CAASC,eAAT,CAhBqB,CAAxB,CAkBA,GAAMa,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,SAAMV,CAAAA,IAAI,EAAIQ,IAAI,CAACR,IAAD,CAAlB,EAAjB,CAEAV,SAAS,CAAC,UAAM,CACdc,QAAQ,GACT,CAFQ,CAEN,CAACA,QAAD,CAFM,CAAT,CAIA,MAAO,CAAEA,QAAQ,CAARA,QAAF,CAAYM,QAAQ,CAARA,QAAZ,CAAsBZ,MAAM,CAANA,MAAtB,CAA8BG,OAAO,CAAPA,OAA9B,CAAuCD,IAAI,CAAJA,IAAvC,CAA6CE,YAAY,CAAZA,YAA7C,CAAP,CACD,CA5CM","sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { useSnackbar } from 'notistack';\nimport { AxiosPromise } from \"axios\";\n\nimport { extractErrorMessage } from \".\";\n\nexport interface RestRequestOptions<D> {\n  read: () => AxiosPromise<D>;\n  update?: (value: D) => AxiosPromise<D>;\n}\n\nexport const useRest = <D>({ read, update }: RestRequestOptions<D>) => {\n  const { enqueueSnackbar } = useSnackbar();\n\n  const [saving, setSaving] = useState<boolean>(false);\n  const [data, setData] = useState<D>();\n  const [errorMessage, setErrorMessage] = useState<string>();\n\n  const loadData = useCallback(async () => {\n    setData(undefined);\n    setErrorMessage(undefined);\n    try {\n      setData((await read()).data);\n    } catch (error: any) {\n      const message = extractErrorMessage(error, 'Problem loading data');\n      enqueueSnackbar(message, { variant: 'error' });\n      setErrorMessage(message);\n    }\n  }, [read, enqueueSnackbar]);\n\n  const save = useCallback(async (toSave: D) => {\n    if (!update) {\n      return;\n    }\n    setSaving(true);\n    setErrorMessage(undefined);\n    try {\n      setData((await update(toSave)).data);\n      enqueueSnackbar(\"Update successful\", { variant: 'success' });\n    } catch (error: any) {\n      const message = extractErrorMessage(error, 'Problem saving data');\n      enqueueSnackbar(message, { variant: 'error' });\n      setErrorMessage(message);\n    } finally {\n      setSaving(false);\n    }\n  }, [update, enqueueSnackbar]);\n\n  const saveData = () => data && save(data);\n\n  useEffect(() => {\n    loadData();\n  }, [loadData]);\n\n  return { loadData, saveData, saving, setData, data, errorMessage } as const;\n};\n"]},"metadata":{},"sourceType":"module"}