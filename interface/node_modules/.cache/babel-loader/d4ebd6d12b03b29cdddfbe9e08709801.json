{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from\"react\";import{useSnackbar}from\"notistack\";import{Avatar,Box,Button,Dialog,DialogActions,DialogContent,DialogTitle,Divider,List,ListItem,ListItemAvatar,ListItemText,TextField,useTheme}from\"@mui/material\";import RefreshIcon from'@mui/icons-material/Refresh';import AccessTimeIcon from'@mui/icons-material/AccessTime';import SwapVerticalCircleIcon from'@mui/icons-material/SwapVerticalCircle';import UpdateIcon from'@mui/icons-material/Update';import DnsIcon from'@mui/icons-material/Dns';import AvTimerIcon from'@mui/icons-material/AvTimer';import*as NTPApi from\"../../api/ntp\";import{NTPSyncStatus}from\"../../types\";import{ButtonRow,FormLoader,SectionContent}from\"../../components\";import{extractErrorMessage,formatDateTime,formatDuration,formatLocalDateTime,useRest}from\"../../utils\";import{AuthenticatedContext}from\"../../contexts/authentication\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var isNtpActive=function isNtpActive(_ref){var status=_ref.status;return status===NTPSyncStatus.NTP_ACTIVE;};export var ntpStatusHighlight=function ntpStatusHighlight(_ref2,theme){var status=_ref2.status;switch(status){case NTPSyncStatus.NTP_INACTIVE:return theme.palette.info.main;case NTPSyncStatus.NTP_ACTIVE:return theme.palette.success.main;default:return theme.palette.error.main;}};export var ntpStatus=function ntpStatus(_ref3){var status=_ref3.status;switch(status){case NTPSyncStatus.NTP_INACTIVE:return\"Inactive\";case NTPSyncStatus.NTP_ACTIVE:return\"Active\";default:return\"Unknown\";}};var NTPStatusForm=function NTPStatusForm(){var _useRest=useRest({read:NTPApi.readNTPStatus}),loadData=_useRest.loadData,data=_useRest.data,errorMessage=_useRest.errorMessage;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),localTime=_useState2[0],setLocalTime=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),settingTime=_useState4[0],setSettingTime=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useContext=useContext(AuthenticatedContext),me=_useContext.me;var updateLocalTime=function updateLocalTime(event){return setLocalTime(event.target.value);};var openSetTime=function openSetTime(){setLocalTime(formatLocalDateTime(new Date()));setSettingTime(true);};var theme=useTheme();var configureTime=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return NTPApi.updateTime({local_time:formatLocalDateTime(new Date(localTime))});case 4:enqueueSnackbar(\"Time set successfully\",{variant:'success'});setSettingTime(false);loadData();_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context.t0,'Problem updating time'),{variant:'error'});case 12:_context.prev=12;setProcessing(false);return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,9,12,15]]);}));return function configureTime(){return _ref4.apply(this,arguments);};}();var renderSetTimeDialog=function renderSetTimeDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:settingTime,onClose:function onClose(){return setSettingTime(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Set Time\"}),/*#__PURE__*/_jsxs(DialogContent,{dividers:true,children:[/*#__PURE__*/_jsx(Box,{mb:2,children:\"Enter local date and time below to set the device's time.\"}),/*#__PURE__*/_jsx(TextField,{label:\"Local Time\",type:\"datetime-local\",value:localTime,onChange:updateLocalTime,disabled:processing,variant:\"outlined\",fullWidth:true,InputLabelProps:{shrink:true}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setSettingTime(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(AccessTimeIcon,{}),variant:\"contained\",onClick:configureTime,disabled:processing,color:\"primary\",autoFocus:true,children:\"Set Time\"})]})]});};var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:ntpStatusHighlight(data,theme)},children:/*#__PURE__*/_jsx(UpdateIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Status\",secondary:ntpStatus(data)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),isNtpActive(data)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DnsIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"NTP Server\",secondary:data.server})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AccessTimeIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Local Time\",secondary:formatDateTime(data.local_time)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(SwapVerticalCircleIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"UTC Time\",secondary:formatDateTime(data.utc_time)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AvTimerIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Uptime\",secondary:formatDuration(data.uptime)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexWrap:\"wrap\",children:[/*#__PURE__*/_jsx(Box,{flexGrow:1,children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(RefreshIcon,{}),variant:\"contained\",color:\"secondary\",onClick:loadData,children:\"Refresh\"})})}),me.admin&&data&&!isNtpActive(data)&&/*#__PURE__*/_jsx(Box,{flexWrap:\"nowrap\",whiteSpace:\"nowrap\",children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{onClick:openSetTime,variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(AccessTimeIcon,{}),children:\"Set Time\"})})})]}),renderSetTimeDialog()]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"NTP Status\",titleGutter:true,children:content()});};export default NTPStatusForm;","map":null,"metadata":{},"sourceType":"module"}