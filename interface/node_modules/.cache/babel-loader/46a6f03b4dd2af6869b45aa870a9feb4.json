{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from'react';import{useSnackbar}from'notistack';import{Box,Fab,Paper,Typography}from'@mui/material';import ForwardIcon from'@mui/icons-material/Forward';import*as AuthenticationApi from'./api/authentication';import{PROJECT_NAME}from'./api/env';import{ValidatedTextField}from'./components';import{SIGN_IN_REQUEST_VALIDATOR,validate}from'./validators';import{extractErrorMessage,onEnterCallback,updateValue}from'./utils';import{AuthenticationContext}from'./contexts/authentication';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var SignIn=function SignIn(){var authenticationContext=useContext(AuthenticationContext);var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useState=useState({username:'',password:''}),_useState2=_slicedToArray(_useState,2),signInRequest=_useState2[0],setSignInRequest=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),fieldErrors=_useState6[0],setFieldErrors=_useState6[1];var updateLoginRequestValue=updateValue(setSignInRequest);var validateAndSignIn=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return validate(SIGN_IN_REQUEST_VALIDATOR,signInRequest);case 4:signIn();_context.next=11;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);setFieldErrors(_context.t0);setProcessing(false);case 11:case\"end\":return _context.stop();}}},_callee,null,[[1,7]]);}));return function validateAndSignIn(){return _ref.apply(this,arguments);};}();var signIn=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$Authentication,loginResponse,_error$response;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return AuthenticationApi.signIn(signInRequest);case 3:_yield$Authentication=_context2.sent;loginResponse=_yield$Authentication.data;authenticationContext.signIn(loginResponse.access_token);_context2.next=12;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);if(((_error$response=_context2.t0.response)===null||_error$response===void 0?void 0:_error$response.status)===401){enqueueSnackbar(\"Invalid login details\",{variant:\"warning\"});}else{enqueueSnackbar(extractErrorMessage(_context2.t0,\"Unexpected error, please try again\"),{variant:\"error\"});}setProcessing(false);case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function signIn(){return _ref2.apply(this,arguments);};}();var submitOnEnter=onEnterCallback(signIn);return/*#__PURE__*/_jsx(Box,{display:\"flex\",height:\"100vh\",margin:\"auto\",padding:2,justifyContent:\"center\",flexDirection:\"column\",maxWidth:function maxWidth(theme){return theme.breakpoints.values.sm;},children:/*#__PURE__*/_jsxs(Paper,{sx:function sx(theme){return{textAlign:\"center\",padding:theme.spacing(2),paddingTop:\"200px\",backgroundImage:'url(\"/app/icon.png\")',backgroundRepeat:\"no-repeat\",backgroundPosition:\"50% \"+theme.spacing(2),backgroundSize:\"auto 150px\",width:\"100%\"};},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:PROJECT_NAME}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,disabled:processing,name:\"username\",label:\"Username\",value:signInRequest.username,onChange:updateLoginRequestValue,margin:\"normal\",variant:\"outlined\",fullWidth:true}),/*#__PURE__*/_jsx(ValidatedTextField,{fieldErrors:fieldErrors,disabled:processing,type:\"password\",name:\"password\",label:\"Password\",value:signInRequest.password,onChange:updateLoginRequestValue,onKeyDown:submitOnEnter,margin:\"normal\",variant:\"outlined\",fullWidth:true}),/*#__PURE__*/_jsxs(Fab,{variant:\"extended\",color:\"primary\",sx:{mt:2},onClick:validateAndSignIn,disabled:processing,children:[/*#__PURE__*/_jsx(ForwardIcon,{sx:{mr:1}}),\"Sign In\"]})]})});};export default SignIn;","map":null,"metadata":{},"sourceType":"module"}