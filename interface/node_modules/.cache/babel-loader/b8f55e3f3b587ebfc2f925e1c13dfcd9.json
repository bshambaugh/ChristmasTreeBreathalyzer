{"ast":null,"code":"import jwtDecode from'jwt-decode';import{ACCESS_TOKEN,AXIOS}from\"./endpoints\";import{PROJECT_PATH}from'./env';export var SIGN_IN_PATHNAME='loginPathname';export var SIGN_IN_SEARCH='loginSearch';export var getDefaultRoute=function getDefaultRoute(features){return features.project?\"/\".concat(PROJECT_PATH):\"/wifi\";};export function verifyAuthorization(){return AXIOS.get('/verifyAuthorization');}export function signIn(request){return AXIOS.post('/signIn',request);}/**\n * Fallback to sessionStorage if localStorage is absent. WebView may not have local storage enabled.\n */export function getStorage(){return localStorage||sessionStorage;}export function storeLoginRedirect(location){if(location){getStorage().setItem(SIGN_IN_PATHNAME,location.pathname);getStorage().setItem(SIGN_IN_SEARCH,location.search);}}export function clearLoginRedirect(){getStorage().removeItem(SIGN_IN_PATHNAME);getStorage().removeItem(SIGN_IN_SEARCH);}export function fetchLoginRedirect(features){var signInPathname=getStorage().getItem(SIGN_IN_PATHNAME);var signInSearch=getStorage().getItem(SIGN_IN_SEARCH);clearLoginRedirect();return{pathname:signInPathname||getDefaultRoute(features),search:signInPathname&&signInSearch||undefined};}export var clearAccessToken=function clearAccessToken(){return localStorage.removeItem(ACCESS_TOKEN);};export var decodeMeJWT=function decodeMeJWT(accessToken){return jwtDecode(accessToken);};export function addAccessTokenParameter(url){var accessToken=getStorage().getItem(ACCESS_TOKEN);if(!accessToken){return url;}var parsedUrl=new URL(url);parsedUrl.searchParams.set(ACCESS_TOKEN,accessToken);return parsedUrl.toString();}","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/api/authentication.ts"],"names":["jwtDecode","ACCESS_TOKEN","AXIOS","PROJECT_PATH","SIGN_IN_PATHNAME","SIGN_IN_SEARCH","getDefaultRoute","features","project","verifyAuthorization","get","signIn","request","post","getStorage","localStorage","sessionStorage","storeLoginRedirect","location","setItem","pathname","search","clearLoginRedirect","removeItem","fetchLoginRedirect","signInPathname","getItem","signInSearch","undefined","clearAccessToken","decodeMeJWT","accessToken","addAccessTokenParameter","url","parsedUrl","URL","searchParams","set","toString"],"mappings":"AAEA,MAAOA,CAAAA,SAAP,KAAsB,YAAtB,CAKA,OAASC,YAAT,CAAuBC,KAAvB,KAAoC,aAApC,CACA,OAASC,YAAT,KAA6B,OAA7B,CAEA,MAAO,IAAMC,CAAAA,gBAAgB,CAAG,eAAzB,CACP,MAAO,IAAMC,CAAAA,cAAc,CAAG,aAAvB,CAEP,MAAO,IAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,QAAD,QAAwBA,CAAAA,QAAQ,CAACC,OAAT,YAAuBL,YAAvB,EAAwC,OAAhE,EAAxB,CAEP,MAAO,SAASM,CAAAA,mBAAT,EAAmD,CACxD,MAAOP,CAAAA,KAAK,CAACQ,GAAN,CAAU,sBAAV,CAAP,CACD,CAED,MAAO,SAASC,CAAAA,MAAT,CAAgBC,OAAhB,CAAsE,CAC3E,MAAOV,CAAAA,KAAK,CAACW,IAAN,CAAW,SAAX,CAAsBD,OAAtB,CAAP,CACD,CAED;AACA;AACA,GACA,MAAO,SAASE,CAAAA,UAAT,EAAsB,CAC3B,MAAOC,CAAAA,YAAY,EAAIC,cAAvB,CACD,CAED,MAAO,SAASC,CAAAA,kBAAT,CAA4BC,QAA5B,CAAmD,CACxD,GAAIA,QAAJ,CAAc,CACZJ,UAAU,GAAGK,OAAb,CAAqBf,gBAArB,CAAuCc,QAAQ,CAACE,QAAhD,EACAN,UAAU,GAAGK,OAAb,CAAqBd,cAArB,CAAqCa,QAAQ,CAACG,MAA9C,EACD,CACF,CAED,MAAO,SAASC,CAAAA,kBAAT,EAA8B,CACnCR,UAAU,GAAGS,UAAb,CAAwBnB,gBAAxB,EACAU,UAAU,GAAGS,UAAb,CAAwBlB,cAAxB,EACD,CAED,MAAO,SAASmB,CAAAA,kBAAT,CAA4BjB,QAA5B,CAA+D,CACpE,GAAMkB,CAAAA,cAAc,CAAGX,UAAU,GAAGY,OAAb,CAAqBtB,gBAArB,CAAvB,CACA,GAAMuB,CAAAA,YAAY,CAAGb,UAAU,GAAGY,OAAb,CAAqBrB,cAArB,CAArB,CACAiB,kBAAkB,GAClB,MAAO,CACLF,QAAQ,CAAEK,cAAc,EAAInB,eAAe,CAACC,QAAD,CADtC,CAELc,MAAM,CAAGI,cAAc,EAAIE,YAAnB,EAAoCC,SAFvC,CAAP,CAID,CAED,MAAO,IAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,SAAMd,CAAAA,YAAY,CAACQ,UAAb,CAAwBtB,YAAxB,CAAN,EAAzB,CACP,MAAO,IAAM6B,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,WAAD,QAA6B/B,CAAAA,SAAS,CAAC+B,WAAD,CAAtC,EAApB,CAEP,MAAO,SAASC,CAAAA,uBAAT,CAAiCC,GAAjC,CAA8C,CACnD,GAAMF,CAAAA,WAAW,CAAGjB,UAAU,GAAGY,OAAb,CAAqBzB,YAArB,CAApB,CACA,GAAI,CAAC8B,WAAL,CAAkB,CAChB,MAAOE,CAAAA,GAAP,CACD,CACD,GAAMC,CAAAA,SAAS,CAAG,GAAIC,CAAAA,GAAJ,CAAQF,GAAR,CAAlB,CACAC,SAAS,CAACE,YAAV,CAAuBC,GAAvB,CAA2BpC,YAA3B,CAAyC8B,WAAzC,EACA,MAAOG,CAAAA,SAAS,CAACI,QAAV,EAAP,CACD","sourcesContent":["import { AxiosPromise } from \"axios\";\nimport * as H from 'history';\nimport jwtDecode from 'jwt-decode';\nimport { Path } from \"react-router-dom\";\n\nimport { Features, Me, SignInRequest, SignInResponse } from \"../types\";\n\nimport { ACCESS_TOKEN, AXIOS } from \"./endpoints\";\nimport { PROJECT_PATH } from './env';\n\nexport const SIGN_IN_PATHNAME = 'loginPathname';\nexport const SIGN_IN_SEARCH = 'loginSearch';\n\nexport const getDefaultRoute = (features: Features) => features.project ? `/${PROJECT_PATH}` : \"/wifi\";\n\nexport function verifyAuthorization(): AxiosPromise<void> {\n  return AXIOS.get('/verifyAuthorization');\n}\n\nexport function signIn(request: SignInRequest): AxiosPromise<SignInResponse> {\n  return AXIOS.post('/signIn', request);\n}\n\n/**\n * Fallback to sessionStorage if localStorage is absent. WebView may not have local storage enabled.\n */\nexport function getStorage() {\n  return localStorage || sessionStorage;\n}\n\nexport function storeLoginRedirect(location?: H.Location) {\n  if (location) {\n    getStorage().setItem(SIGN_IN_PATHNAME, location.pathname);\n    getStorage().setItem(SIGN_IN_SEARCH, location.search);\n  }\n}\n\nexport function clearLoginRedirect() {\n  getStorage().removeItem(SIGN_IN_PATHNAME);\n  getStorage().removeItem(SIGN_IN_SEARCH);\n}\n\nexport function fetchLoginRedirect(features: Features): Partial<Path> {\n  const signInPathname = getStorage().getItem(SIGN_IN_PATHNAME);\n  const signInSearch = getStorage().getItem(SIGN_IN_SEARCH);\n  clearLoginRedirect();\n  return {\n    pathname: signInPathname || getDefaultRoute(features),\n    search: (signInPathname && signInSearch) || undefined\n  };\n}\n\nexport const clearAccessToken = () => localStorage.removeItem(ACCESS_TOKEN);\nexport const decodeMeJWT = (accessToken: string): Me => jwtDecode(accessToken) as Me;\n\nexport function addAccessTokenParameter(url: string) {\n  const accessToken = getStorage().getItem(ACCESS_TOKEN);\n  if (!accessToken) {\n    return url;\n  }\n  const parsedUrl = new URL(url);\n  parsedUrl.searchParams.set(ACCESS_TOKEN, accessToken);\n  return parsedUrl.toString();\n}\n"]},"metadata":{},"sourceType":"module"}