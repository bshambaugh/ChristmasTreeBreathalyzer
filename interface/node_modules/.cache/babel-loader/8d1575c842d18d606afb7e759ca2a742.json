{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from\"react\";import{useSnackbar}from\"notistack\";import{Avatar,Box,Button,Dialog,DialogActions,DialogContent,DialogTitle,Divider,List,ListItem,ListItemAvatar,ListItemText,TextField,useTheme}from\"@mui/material\";import RefreshIcon from'@mui/icons-material/Refresh';import AccessTimeIcon from'@mui/icons-material/AccessTime';import SwapVerticalCircleIcon from'@mui/icons-material/SwapVerticalCircle';import UpdateIcon from'@mui/icons-material/Update';import DnsIcon from'@mui/icons-material/Dns';import AvTimerIcon from'@mui/icons-material/AvTimer';import*as NTPApi from\"../../api/ntp\";import{NTPSyncStatus}from\"../../types\";import{ButtonRow,FormLoader,SectionContent}from\"../../components\";import{extractErrorMessage,formatDateTime,formatDuration,formatLocalDateTime,useRest}from\"../../utils\";import{AuthenticatedContext}from\"../../contexts/authentication\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export var isNtpActive=function isNtpActive(_ref){var status=_ref.status;return status===NTPSyncStatus.NTP_ACTIVE;};export var ntpStatusHighlight=function ntpStatusHighlight(_ref2,theme){var status=_ref2.status;switch(status){case NTPSyncStatus.NTP_INACTIVE:return theme.palette.info.main;case NTPSyncStatus.NTP_ACTIVE:return theme.palette.success.main;default:return theme.palette.error.main;}};export var ntpStatus=function ntpStatus(_ref3){var status=_ref3.status;switch(status){case NTPSyncStatus.NTP_INACTIVE:return\"Inactive\";case NTPSyncStatus.NTP_ACTIVE:return\"Active\";default:return\"Unknown\";}};var NTPStatusForm=function NTPStatusForm(){var _useRest=useRest({read:NTPApi.readNTPStatus}),loadData=_useRest.loadData,data=_useRest.data,errorMessage=_useRest.errorMessage;var _useState=useState(''),_useState2=_slicedToArray(_useState,2),localTime=_useState2[0],setLocalTime=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),settingTime=_useState4[0],setSettingTime=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useContext=useContext(AuthenticatedContext),me=_useContext.me;var updateLocalTime=function updateLocalTime(event){return setLocalTime(event.target.value);};var openSetTime=function openSetTime(){setLocalTime(formatLocalDateTime(new Date()));setSettingTime(true);};var theme=useTheme();var configureTime=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return NTPApi.updateTime({local_time:formatLocalDateTime(new Date(localTime))});case 4:enqueueSnackbar(\"Time set successfully\",{variant:'success'});setSettingTime(false);loadData();_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context.t0,'Problem updating time'),{variant:'error'});case 12:_context.prev=12;setProcessing(false);return _context.finish(12);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,9,12,15]]);}));return function configureTime(){return _ref4.apply(this,arguments);};}();var renderSetTimeDialog=function renderSetTimeDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:settingTime,onClose:function onClose(){return setSettingTime(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Set Time\"}),/*#__PURE__*/_jsxs(DialogContent,{dividers:true,children:[/*#__PURE__*/_jsx(Box,{mb:2,children:\"Enter local date and time below to set the device's time.\"}),/*#__PURE__*/_jsx(TextField,{label:\"Local Time\",type:\"datetime-local\",value:localTime,onChange:updateLocalTime,disabled:processing,variant:\"outlined\",fullWidth:true,InputLabelProps:{shrink:true}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setSettingTime(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(AccessTimeIcon,{}),variant:\"contained\",onClick:configureTime,disabled:processing,color:\"primary\",autoFocus:true,children:\"Set Time\"})]})]});};var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{sx:{bgcolor:ntpStatusHighlight(data,theme)},children:/*#__PURE__*/_jsx(UpdateIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Status\",secondary:ntpStatus(data)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),isNtpActive(data)&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DnsIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"NTP Server\",secondary:data.server})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AccessTimeIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Local Time\",secondary:formatDateTime(data.local_time)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(SwapVerticalCircleIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"UTC Time\",secondary:formatDateTime(data.utc_time)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AvTimerIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Uptime\",secondary:formatDuration(data.uptime)})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexWrap:\"wrap\",children:[/*#__PURE__*/_jsx(Box,{flexGrow:1,children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(RefreshIcon,{}),variant:\"contained\",color:\"secondary\",onClick:loadData,children:\"Refresh\"})})}),me.admin&&data&&!isNtpActive(data)&&/*#__PURE__*/_jsx(Box,{flexWrap:\"nowrap\",whiteSpace:\"nowrap\",children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{onClick:openSetTime,variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(AccessTimeIcon,{}),children:\"Set Time\"})})})]}),renderSetTimeDialog()]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"NTP Status\",titleGutter:true,children:content()});};export default NTPStatusForm;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/ntp/NTPStatusForm.tsx"],"names":["useContext","useState","useSnackbar","Avatar","Box","Button","Dialog","DialogActions","DialogContent","DialogTitle","Divider","List","ListItem","ListItemAvatar","ListItemText","TextField","useTheme","RefreshIcon","AccessTimeIcon","SwapVerticalCircleIcon","UpdateIcon","DnsIcon","AvTimerIcon","NTPApi","NTPSyncStatus","ButtonRow","FormLoader","SectionContent","extractErrorMessage","formatDateTime","formatDuration","formatLocalDateTime","useRest","AuthenticatedContext","isNtpActive","status","NTP_ACTIVE","ntpStatusHighlight","theme","NTP_INACTIVE","palette","info","main","success","error","ntpStatus","NTPStatusForm","read","readNTPStatus","loadData","data","errorMessage","localTime","setLocalTime","settingTime","setSettingTime","processing","setProcessing","enqueueSnackbar","me","updateLocalTime","event","target","value","openSetTime","Date","configureTime","updateTime","local_time","variant","renderSetTimeDialog","shrink","content","bgcolor","server","utc_time","uptime","admin"],"mappings":"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","sourcesContent":["import { FC, useContext, useState } from \"react\";\nimport { useSnackbar } from \"notistack\";\n\nimport {\n  Avatar, Box, Button, Dialog, DialogActions, DialogContent, DialogTitle,\n  Divider, List, ListItem, ListItemAvatar, ListItemText, TextField, Theme, useTheme\n} from \"@mui/material\";\nimport RefreshIcon from '@mui/icons-material/Refresh';\nimport AccessTimeIcon from '@mui/icons-material/AccessTime';\nimport SwapVerticalCircleIcon from '@mui/icons-material/SwapVerticalCircle';\nimport UpdateIcon from '@mui/icons-material/Update';\nimport DnsIcon from '@mui/icons-material/Dns';\nimport AvTimerIcon from '@mui/icons-material/AvTimer';\n\nimport * as NTPApi from \"../../api/ntp\";\nimport { NTPStatus, NTPSyncStatus } from \"../../types\";\nimport { ButtonRow, FormLoader, SectionContent } from \"../../components\";\nimport { extractErrorMessage, formatDateTime, formatDuration, formatLocalDateTime, useRest } from \"../../utils\";\nimport { AuthenticatedContext } from \"../../contexts/authentication\";\n\nexport const isNtpActive = ({ status }: NTPStatus) => status === NTPSyncStatus.NTP_ACTIVE;\n\nexport const ntpStatusHighlight = ({ status }: NTPStatus, theme: Theme) => {\n  switch (status) {\n    case NTPSyncStatus.NTP_INACTIVE:\n      return theme.palette.info.main;\n    case NTPSyncStatus.NTP_ACTIVE:\n      return theme.palette.success.main;\n    default:\n      return theme.palette.error.main;\n  }\n};\n\nexport const ntpStatus = ({ status }: NTPStatus) => {\n  switch (status) {\n    case NTPSyncStatus.NTP_INACTIVE:\n      return \"Inactive\";\n    case NTPSyncStatus.NTP_ACTIVE:\n      return \"Active\";\n    default:\n      return \"Unknown\";\n  }\n};\n\nconst NTPStatusForm: FC = () => {\n  const { loadData, data, errorMessage } = useRest<NTPStatus>({ read: NTPApi.readNTPStatus });\n  const [localTime, setLocalTime] = useState<string>('');\n  const [settingTime, setSettingTime] = useState<boolean>(false);\n  const [processing, setProcessing] = useState<boolean>(false);\n  const { enqueueSnackbar } = useSnackbar();\n  const { me } = useContext(AuthenticatedContext);\n\n  const updateLocalTime = (event: React.ChangeEvent<HTMLInputElement>) => setLocalTime(event.target.value);\n\n  const openSetTime = () => {\n    setLocalTime(formatLocalDateTime(new Date()));\n    setSettingTime(true);\n  };\n\n  const theme = useTheme();\n\n  const configureTime = async () => {\n    setProcessing(true);\n    try {\n      await NTPApi.updateTime({\n        local_time: formatLocalDateTime(new Date(localTime))\n      });\n      enqueueSnackbar(\"Time set successfully\", { variant: 'success' });\n      setSettingTime(false);\n      loadData();\n    } catch (error: any) {\n      enqueueSnackbar(extractErrorMessage(error, 'Problem updating time'), { variant: 'error' });\n    } finally {\n      setProcessing(false);\n    }\n  };\n\n  const renderSetTimeDialog = () => {\n    return (\n      <Dialog\n        open={settingTime}\n        onClose={() => setSettingTime(false)}\n      >\n        <DialogTitle>Set Time</DialogTitle>\n        <DialogContent dividers>\n          <Box mb={2}>Enter local date and time below to set the device's time.</Box>\n          <TextField\n            label=\"Local Time\"\n            type=\"datetime-local\"\n            value={localTime}\n            onChange={updateLocalTime}\n            disabled={processing}\n            variant=\"outlined\"\n            fullWidth\n            InputLabelProps={{\n              shrink: true,\n            }}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button variant=\"contained\" onClick={() => setSettingTime(false)} color=\"secondary\">\n            Cancel\n          </Button>\n          <Button\n            startIcon={<AccessTimeIcon />}\n            variant=\"contained\"\n            onClick={configureTime}\n            disabled={processing}\n            color=\"primary\"\n            autoFocus\n          >\n            Set Time\n          </Button>\n        </DialogActions>\n      </Dialog>\n    );\n  };\n\n  const content = () => {\n    if (!data) {\n      return (<FormLoader onRetry={loadData} errorMessage={errorMessage} />);\n    }\n\n    return (\n      <>\n        <List>\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar sx={{ bgcolor: ntpStatusHighlight(data, theme) }}>\n                <UpdateIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Status\" secondary={ntpStatus(data)} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          {isNtpActive(data) && (\n            <>\n              <ListItem>\n                <ListItemAvatar>\n                  <Avatar>\n                    <DnsIcon />\n                  </Avatar>\n                </ListItemAvatar>\n                <ListItemText primary=\"NTP Server\" secondary={data.server} />\n              </ListItem>\n              <Divider variant=\"inset\" component=\"li\" />\n            </>\n          )}\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <AccessTimeIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Local Time\" secondary={formatDateTime(data.local_time)} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <SwapVerticalCircleIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"UTC Time\" secondary={formatDateTime(data.utc_time)} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n          <ListItem>\n            <ListItemAvatar>\n              <Avatar>\n                <AvTimerIcon />\n              </Avatar>\n            </ListItemAvatar>\n            <ListItemText primary=\"Uptime\" secondary={formatDuration(data.uptime)} />\n          </ListItem>\n          <Divider variant=\"inset\" component=\"li\" />\n        </List>\n        <Box display=\"flex\" flexWrap=\"wrap\">\n          <Box flexGrow={1}>\n            <ButtonRow mt={1}>\n              <Button startIcon={<RefreshIcon />} variant=\"contained\" color=\"secondary\" onClick={loadData}>\n                Refresh\n              </Button>\n            </ButtonRow>\n          </Box>\n          {\n            me.admin && data && !isNtpActive(data) && (\n              <Box flexWrap=\"nowrap\" whiteSpace=\"nowrap\">\n                <ButtonRow mt={1}>\n                  <Button onClick={openSetTime} variant=\"contained\" color=\"primary\" startIcon={<AccessTimeIcon />}>\n                    Set Time\n                  </Button>\n                </ButtonRow>\n              </Box>\n            )\n          }\n        </Box>\n        {renderSetTimeDialog()}\n      </>\n    );\n  };\n\n  return (\n    <SectionContent title='NTP Status' titleGutter>\n      {content()}\n    </SectionContent>\n  );\n\n};\n\nexport default NTPStatusForm;\n"]},"metadata":{},"sourceType":"module"}