{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useState,useCallback,useRef}from'react';import{useSnackbar}from'notistack';import{Button}from'@mui/material';import PermScanWifiIcon from'@mui/icons-material/PermScanWifi';import*as WiFiApi from\"../../api/wifi\";import{ButtonRow,FormLoader,SectionContent}from'../../components';import{extractErrorMessage}from'../../utils';import WiFiNetworkSelector from'./WiFiNetworkSelector';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NUM_POLLS=10;var POLLING_FREQUENCY=500;var compareNetworks=function compareNetworks(network1,network2){if(network1.rssi<network2.rssi)return 1;if(network1.rssi>network2.rssi)return-1;return 0;};var WiFiNetworkScanner=function WiFiNetworkScanner(){var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var pollCount=useRef(0);var _useState=useState(),_useState2=_slicedToArray(_useState,2),networkList=_useState2[0],setNetworkList=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var finishedWithError=useCallback(function(message){enqueueSnackbar(message,{variant:'error'});setNetworkList(undefined);setErrorMessage(message);},[enqueueSnackbar]);var pollNetworkList=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,completedPollCount,newNetworkList;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return WiFiApi.listNetworks();case 3:response=_context.sent;if(response.status===202){completedPollCount=pollCount.current+1;if(completedPollCount<NUM_POLLS){pollCount.current=completedPollCount;setTimeout(pollNetworkList,POLLING_FREQUENCY);}else{finishedWithError(\"Device did not return network list in timely manner\");}}else{newNetworkList=response.data;newNetworkList.networks.sort(compareNetworks);setNetworkList(newNetworkList);}_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);finishedWithError(extractErrorMessage(_context.t0,'Problem listing WiFi networks'));case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),[finishedWithError]);var startNetworkScan=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pollCount.current=0;setNetworkList(undefined);setErrorMessage(undefined);_context2.prev=3;_context2.next=6;return WiFiApi.scanNetworks();case 6:setTimeout(pollNetworkList,POLLING_FREQUENCY);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](3);finishedWithError(extractErrorMessage(_context2.t0,'Problem scanning for WiFi networks'));case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[3,9]]);})),[finishedWithError,pollNetworkList]);useEffect(function(){startNetworkScan();},[startNetworkScan]);var renderNetworkScanner=function renderNetworkScanner(){if(!networkList){return/*#__PURE__*/_jsx(FormLoader,{message:\"Scanning\\u2026\",errorMessage:errorMessage});}return/*#__PURE__*/_jsx(WiFiNetworkSelector,{networkList:networkList});};return/*#__PURE__*/_jsxs(SectionContent,{title:\"Network Scanner\",children:[renderNetworkScanner(),/*#__PURE__*/_jsx(ButtonRow,{pt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PermScanWifiIcon,{}),variant:\"contained\",color:\"secondary\",onClick:startNetworkScan,disabled:!errorMessage&&!networkList,children:\"Scan again\\u2026\"})})]});};export default WiFiNetworkScanner;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/wifi/WiFiNetworkScanner.tsx"],"names":["useEffect","useState","useCallback","useRef","useSnackbar","Button","PermScanWifiIcon","WiFiApi","ButtonRow","FormLoader","SectionContent","extractErrorMessage","WiFiNetworkSelector","NUM_POLLS","POLLING_FREQUENCY","compareNetworks","network1","network2","rssi","WiFiNetworkScanner","enqueueSnackbar","pollCount","networkList","setNetworkList","errorMessage","setErrorMessage","finishedWithError","message","variant","undefined","pollNetworkList","listNetworks","response","status","completedPollCount","current","setTimeout","newNetworkList","data","networks","sort","startNetworkScan","scanNetworks","renderNetworkScanner"],"mappings":"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","sourcesContent":["import { useEffect, FC, useState, useCallback, useRef } from 'react';\nimport { useSnackbar } from 'notistack';\n\nimport { Button, } from '@mui/material';\nimport PermScanWifiIcon from '@mui/icons-material/PermScanWifi';\n\nimport * as WiFiApi from \"../../api/wifi\";\nimport { WiFiNetwork, WiFiNetworkList } from '../../types';\nimport { ButtonRow, FormLoader, SectionContent } from '../../components';\nimport { extractErrorMessage } from '../../utils';\n\nimport WiFiNetworkSelector from './WiFiNetworkSelector';\n\nconst NUM_POLLS = 10;\nconst POLLING_FREQUENCY = 500;\n\nconst compareNetworks = (network1: WiFiNetwork, network2: WiFiNetwork) => {\n  if (network1.rssi < network2.rssi)\n    return 1;\n  if (network1.rssi > network2.rssi)\n    return -1;\n  return 0;\n};\n\nconst WiFiNetworkScanner: FC = () => {\n\n  const { enqueueSnackbar } = useSnackbar();\n\n  const pollCount = useRef(0);\n  const [networkList, setNetworkList] = useState<WiFiNetworkList>();\n  const [errorMessage, setErrorMessage] = useState<string>();\n\n  const finishedWithError = useCallback((message: string) => {\n    enqueueSnackbar(message, { variant: 'error' });\n    setNetworkList(undefined);\n    setErrorMessage(message);\n  }, [enqueueSnackbar]);\n\n  const pollNetworkList = useCallback(async () => {\n    try {\n      const response = await WiFiApi.listNetworks();\n      if (response.status === 202) {\n        const completedPollCount = pollCount.current + 1;\n        if (completedPollCount < NUM_POLLS) {\n          pollCount.current = completedPollCount;\n          setTimeout(pollNetworkList, POLLING_FREQUENCY);\n        } else {\n          finishedWithError(\"Device did not return network list in timely manner\");\n        }\n      } else {\n        const newNetworkList = response.data;\n        newNetworkList.networks.sort(compareNetworks);\n        setNetworkList(newNetworkList);\n      }\n    } catch (error: any) {\n      finishedWithError(extractErrorMessage(error, 'Problem listing WiFi networks'));\n    }\n  }, [finishedWithError]);\n\n  const startNetworkScan = useCallback(async () => {\n    pollCount.current = 0;\n    setNetworkList(undefined);\n    setErrorMessage(undefined);\n    try {\n      await WiFiApi.scanNetworks();\n      setTimeout(pollNetworkList, POLLING_FREQUENCY);\n    } catch (error: any) {\n      finishedWithError(extractErrorMessage(error, 'Problem scanning for WiFi networks'));\n    }\n  }, [finishedWithError, pollNetworkList]);\n\n  useEffect(() => { startNetworkScan(); }, [startNetworkScan]);\n\n  const renderNetworkScanner = () => {\n    if (!networkList) {\n      return (<FormLoader message=\"Scanning&hellip;\" errorMessage={errorMessage} />);\n    }\n    return (\n      <WiFiNetworkSelector networkList={networkList} />\n    );\n  };\n\n  return (\n    <SectionContent title=\"Network Scanner\">\n      {renderNetworkScanner()}\n      <ButtonRow pt={1}>\n        <Button\n          startIcon={<PermScanWifiIcon />}\n          variant=\"contained\"\n          color=\"secondary\"\n          onClick={startNetworkScan}\n          disabled={!errorMessage && !networkList}\n        >\n          Scan again&hellip;\n        </Button>\n      </ButtonRow>\n    </SectionContent>\n  );\n\n};\n\nexport default WiFiNetworkScanner;\n"]},"metadata":{},"sourceType":"module"}