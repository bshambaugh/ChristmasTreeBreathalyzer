{"ast":null,"code":"import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useRef,useState}from'react';import Sockette from'sockette';import{debounce}from'lodash';import{addAccessTokenParameter}from'../api/authentication';export var useWs=function useWs(wsUrl){var wsThrottle=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var ws=useRef();var clientId=useRef();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),connected=_useState2[0],setConnected=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),transmit=_useState6[0],setTransmit=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),clear=_useState8[0],setClear=_useState8[1];var onMessage=useCallback(function(event){var rawData=event.data;if(typeof rawData==='string'||rawData instanceof String){var message=JSON.parse(rawData);switch(message.type){case\"id\":clientId.current=message.id;break;case\"payload\":if(clientId.current){setData(function(existingData){return clientId.current===message.origin_id&&existingData||message.payload;});}break;}}},[]);var doSaveData=useCallback(function(newData){var clearData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!ws.current){return;}if(clearData){setData(undefined);}ws.current.json(newData);},[]);var saveData=useRef(debounce(doSaveData,wsThrottle));var updateData=function updateData(newData){var transmitData=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var clearData=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;setData(newData);setTransmit(transmitData);setClear(clearData);};useEffect(function(){if(!transmit){return;}data&&saveData.current(data,clear);setTransmit(false);setClear(false);},[doSaveData,data,transmit,clear]);useEffect(function(){var instance=new Sockette(addAccessTokenParameter(wsUrl),{onmessage:onMessage,onopen:function onopen(){setConnected(true);},onclose:function onclose(){clientId.current=undefined;setConnected(false);setData(undefined);}});ws.current=instance;return instance.close;},[wsUrl,onMessage]);return{connected:connected,data:data,updateData:updateData};};","map":null,"metadata":{},"sourceType":"module"}