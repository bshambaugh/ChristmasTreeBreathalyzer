{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from'react';import{Button,IconButton,Table,TableBody,TableCell,TableFooter,TableHead,TableRow}from'@mui/material';import SaveIcon from'@mui/icons-material/Save';import DeleteIcon from'@mui/icons-material/Delete';import PersonAddIcon from'@mui/icons-material/PersonAdd';import EditIcon from'@mui/icons-material/Edit';import CheckIcon from'@mui/icons-material/Check';import CloseIcon from'@mui/icons-material/Close';import*as SecurityApi from\"../../api/security\";import{ButtonRow,FormLoader,MessageBox,SectionContent}from'../../components';import{createUserValidator}from'../../validators';import{useRest}from'../../utils';import{AuthenticatedContext}from'../../contexts/authentication';import UserForm from'./UserForm';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function compareUsers(a,b){if(a.username<b.username){return-1;}if(a.username>b.username){return 1;}return 0;}var SecuritySettingsForm=function SecuritySettingsForm(){var _useRest=useRest({read:SecurityApi.readSecuritySettings,update:SecurityApi.updateSecuritySettings}),loadData=_useRest.loadData,saving=_useRest.saving,data=_useRest.data,setData=_useRest.setData,saveData=_useRest.saveData,errorMessage=_useRest.errorMessage;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),creating=_useState4[0],setCreating=_useState4[1];var authenticatedContext=useContext(AuthenticatedContext);var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}var noAdminConfigured=function noAdminConfigured(){return!data.users.find(function(u){return u.admin;});};var removeUser=function removeUser(toRemove){var users=data.users.filter(function(u){return u.username!==toRemove.username;});setData(_objectSpread(_objectSpread({},data),{},{users:users}));};var createUser=function createUser(){setCreating(true);setUser({username:\"\",password:\"\",admin:true});};var editUser=function editUser(toEdit){setCreating(false);setUser(_objectSpread({},toEdit));};var cancelEditingUser=function cancelEditingUser(){setUser(undefined);};var doneEditingUser=function doneEditingUser(){if(user){var users=[].concat(_toConsumableArray(data.users.filter(function(u){return u.username!==user.username;})),[user]);setData(_objectSpread(_objectSpread({},data),{},{users:users}));setUser(undefined);}};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return saveData();case 2:authenticatedContext.refresh();case 3:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Username\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Admin?\"}),/*#__PURE__*/_jsx(TableCell,{})]})}),/*#__PURE__*/_jsx(TableBody,{children:data.users.sort(compareUsers).map(function(u){return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",scope:\"row\",children:u.username}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:u.admin?/*#__PURE__*/_jsx(CheckIcon,{}):/*#__PURE__*/_jsx(CloseIcon,{})}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"Delete\",onClick:function onClick(){return removeUser(u);},children:/*#__PURE__*/_jsx(DeleteIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"Edit\",onClick:function onClick(){return editUser(u);},children:/*#__PURE__*/_jsx(EditIcon,{})})]})]},u.username);})}),/*#__PURE__*/_jsx(TableFooter,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{colSpan:2}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",padding:\"normal\",children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PersonAddIcon,{}),variant:\"contained\",color:\"secondary\",onClick:createUser,children:\"Add\"})})]})})]}),noAdminConfigured()&&/*#__PURE__*/_jsx(MessageBox,{level:\"warning\",message:\"You must have at least one admin user configured.\",my:2}),/*#__PURE__*/_jsx(ButtonRow,{mt:2,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),disabled:saving||noAdminConfigured(),variant:\"contained\",color:\"primary\",type:\"submit\",onClick:onSubmit,children:\"Save\"})}),/*#__PURE__*/_jsx(UserForm,{user:user,setUser:setUser,creating:creating,onDoneEditing:doneEditingUser,onCancelEditing:cancelEditingUser,validator:createUserValidator(data.users,creating)})]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"Manage Users\",titleGutter:true,children:content()});};export default SecuritySettingsForm;","map":null,"metadata":{},"sourceType":"module"}