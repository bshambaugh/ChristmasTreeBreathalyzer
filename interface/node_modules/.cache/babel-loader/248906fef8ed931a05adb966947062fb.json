{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from'react';import{Button,IconButton,Table,TableBody,TableCell,TableFooter,TableHead,TableRow}from'@mui/material';import SaveIcon from'@mui/icons-material/Save';import DeleteIcon from'@mui/icons-material/Delete';import PersonAddIcon from'@mui/icons-material/PersonAdd';import EditIcon from'@mui/icons-material/Edit';import CheckIcon from'@mui/icons-material/Check';import CloseIcon from'@mui/icons-material/Close';import*as SecurityApi from\"../../api/security\";import{ButtonRow,FormLoader,MessageBox,SectionContent}from'../../components';import{createUserValidator}from'../../validators';import{useRest}from'../../utils';import{AuthenticatedContext}from'../../contexts/authentication';import UserForm from'./UserForm';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function compareUsers(a,b){if(a.username<b.username){return-1;}if(a.username>b.username){return 1;}return 0;}var SecuritySettingsForm=function SecuritySettingsForm(){var _useRest=useRest({read:SecurityApi.readSecuritySettings,update:SecurityApi.updateSecuritySettings}),loadData=_useRest.loadData,saving=_useRest.saving,data=_useRest.data,setData=_useRest.setData,saveData=_useRest.saveData,errorMessage=_useRest.errorMessage;var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),creating=_useState4[0],setCreating=_useState4[1];var authenticatedContext=useContext(AuthenticatedContext);var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}var noAdminConfigured=function noAdminConfigured(){return!data.users.find(function(u){return u.admin;});};var removeUser=function removeUser(toRemove){var users=data.users.filter(function(u){return u.username!==toRemove.username;});setData(_objectSpread(_objectSpread({},data),{},{users:users}));};var createUser=function createUser(){setCreating(true);setUser({username:\"\",password:\"\",admin:true});};var editUser=function editUser(toEdit){setCreating(false);setUser(_objectSpread({},toEdit));};var cancelEditingUser=function cancelEditingUser(){setUser(undefined);};var doneEditingUser=function doneEditingUser(){if(user){var users=[].concat(_toConsumableArray(data.users.filter(function(u){return u.username!==user.username;})),[user]);setData(_objectSpread(_objectSpread({},data),{},{users:users}));setUser(undefined);}};var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return saveData();case 2:authenticatedContext.refresh();case 3:case\"end\":return _context.stop();}}},_callee);}));return function onSubmit(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Table,{size:\"small\",children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"Username\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:\"Admin?\"}),/*#__PURE__*/_jsx(TableCell,{})]})}),/*#__PURE__*/_jsx(TableBody,{children:data.users.sort(compareUsers).map(function(u){return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{component:\"th\",scope:\"row\",children:u.username}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:u.admin?/*#__PURE__*/_jsx(CheckIcon,{}):/*#__PURE__*/_jsx(CloseIcon,{})}),/*#__PURE__*/_jsxs(TableCell,{align:\"center\",children:[/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"Delete\",onClick:function onClick(){return removeUser(u);},children:/*#__PURE__*/_jsx(DeleteIcon,{})}),/*#__PURE__*/_jsx(IconButton,{size:\"small\",\"aria-label\":\"Edit\",onClick:function onClick(){return editUser(u);},children:/*#__PURE__*/_jsx(EditIcon,{})})]})]},u.username);})}),/*#__PURE__*/_jsx(TableFooter,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{colSpan:2}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",padding:\"normal\",children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PersonAddIcon,{}),variant:\"contained\",color:\"secondary\",onClick:createUser,children:\"Add\"})})]})})]}),noAdminConfigured()&&/*#__PURE__*/_jsx(MessageBox,{level:\"warning\",message:\"You must have at least one admin user configured.\",my:2}),/*#__PURE__*/_jsx(ButtonRow,{mt:2,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),disabled:saving||noAdminConfigured(),variant:\"contained\",color:\"primary\",type:\"submit\",onClick:onSubmit,children:\"Save\"})}),/*#__PURE__*/_jsx(UserForm,{user:user,setUser:setUser,creating:creating,onDoneEditing:doneEditingUser,onCancelEditing:cancelEditingUser,validator:createUserValidator(data.users,creating)})]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"Manage Users\",titleGutter:true,children:content()});};export default SecuritySettingsForm;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/framework/security/ManageUsersForm.tsx"],"names":["useContext","useState","Button","IconButton","Table","TableBody","TableCell","TableFooter","TableHead","TableRow","SaveIcon","DeleteIcon","PersonAddIcon","EditIcon","CheckIcon","CloseIcon","SecurityApi","ButtonRow","FormLoader","MessageBox","SectionContent","createUserValidator","useRest","AuthenticatedContext","UserForm","compareUsers","a","b","username","SecuritySettingsForm","read","readSecuritySettings","update","updateSecuritySettings","loadData","saving","data","setData","saveData","errorMessage","user","setUser","creating","setCreating","authenticatedContext","content","noAdminConfigured","users","find","u","admin","removeUser","toRemove","filter","createUser","password","editUser","toEdit","cancelEditingUser","undefined","doneEditingUser","onSubmit","refresh","sort","map"],"mappings":"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","sourcesContent":["import { FC, useContext, useState } from 'react';\n\nimport {\n  Button, IconButton, Table, TableBody, TableCell, TableFooter, TableHead, TableRow\n} from '@mui/material';\nimport SaveIcon from '@mui/icons-material/Save';\nimport DeleteIcon from '@mui/icons-material/Delete';\nimport PersonAddIcon from '@mui/icons-material/PersonAdd';\nimport EditIcon from '@mui/icons-material/Edit';\nimport CheckIcon from '@mui/icons-material/Check';\nimport CloseIcon from '@mui/icons-material/Close';\n\nimport * as SecurityApi from \"../../api/security\";\nimport { SecuritySettings, User } from '../../types';\nimport { ButtonRow, FormLoader, MessageBox, SectionContent } from '../../components';\nimport { createUserValidator } from '../../validators';\nimport { useRest } from '../../utils';\nimport { AuthenticatedContext } from '../../contexts/authentication';\n\nimport UserForm from './UserForm';\n\nfunction compareUsers(a: User, b: User) {\n  if (a.username < b.username) {\n    return -1;\n  }\n  if (a.username > b.username) {\n    return 1;\n  }\n  return 0;\n}\n\nconst SecuritySettingsForm: FC = () => {\n  const {\n    loadData, saving, data, setData, saveData, errorMessage\n  } = useRest<SecuritySettings>({ read: SecurityApi.readSecuritySettings, update: SecurityApi.updateSecuritySettings });\n\n  const [user, setUser] = useState<User>();\n  const [creating, setCreating] = useState<boolean>(false);\n  const authenticatedContext = useContext(AuthenticatedContext);\n\n  const content = () => {\n    if (!data) {\n      return (<FormLoader onRetry={loadData} errorMessage={errorMessage} />);\n    }\n\n    const noAdminConfigured = () => !data.users.find((u) => u.admin);\n\n    const removeUser = (toRemove: User) => {\n      const users = data.users.filter((u) => u.username !== toRemove.username);\n      setData({ ...data, users });\n    };\n\n    const createUser = () => {\n      setCreating(true);\n      setUser({\n        username: \"\",\n        password: \"\",\n        admin: true\n      });\n    };\n\n    const editUser = (toEdit: User) => {\n      setCreating(false);\n      setUser({ ...toEdit });\n    };\n\n    const cancelEditingUser = () => {\n      setUser(undefined);\n    };\n\n    const doneEditingUser = () => {\n      if (user) {\n        const users = [...data.users.filter((u) => u.username !== user.username), user];\n        setData({ ...data, users });\n        setUser(undefined);\n      }\n    };\n\n    const onSubmit = async () => {\n      await saveData();\n      authenticatedContext.refresh();\n    };\n\n    return (\n      <>\n        <Table size=\"small\">\n          <TableHead>\n            <TableRow>\n              <TableCell>Username</TableCell>\n              <TableCell align=\"center\">Admin?</TableCell>\n              <TableCell />\n            </TableRow>\n          </TableHead>\n          <TableBody>\n            {data.users.sort(compareUsers).map((u) => (\n              <TableRow key={u.username}>\n                <TableCell component=\"th\" scope=\"row\">\n                  {u.username}\n                </TableCell>\n                <TableCell align=\"center\">\n                  {\n                    u.admin ? <CheckIcon /> : <CloseIcon />\n                  }\n                </TableCell>\n                <TableCell align=\"center\">\n                  <IconButton size=\"small\" aria-label=\"Delete\" onClick={() => removeUser(u)}>\n                    <DeleteIcon />\n                  </IconButton>\n                  <IconButton size=\"small\" aria-label=\"Edit\" onClick={() => editUser(u)}>\n                    <EditIcon />\n                  </IconButton>\n                </TableCell>\n              </TableRow>\n            ))}\n          </TableBody>\n          <TableFooter >\n            <TableRow>\n              <TableCell colSpan={2} />\n              <TableCell align=\"center\" padding=\"normal\">\n                <Button startIcon={<PersonAddIcon />} variant=\"contained\" color=\"secondary\" onClick={createUser}>\n                  Add\n                </Button>\n              </TableCell>\n            </TableRow>\n          </TableFooter>\n        </Table>\n        {\n          noAdminConfigured() &&\n          (\n            <MessageBox\n              level=\"warning\"\n              message=\"You must have at least one admin user configured.\"\n              my={2}\n            />\n          )\n        }\n        <ButtonRow mt={2}>\n          <Button\n            startIcon={<SaveIcon />}\n            disabled={saving || noAdminConfigured()}\n            variant=\"contained\"\n            color=\"primary\"\n            type=\"submit\"\n            onClick={onSubmit}\n          >\n            Save\n          </Button>\n        </ButtonRow>\n        <UserForm\n          user={user}\n          setUser={setUser}\n          creating={creating}\n          onDoneEditing={doneEditingUser}\n          onCancelEditing={cancelEditingUser}\n          validator={createUserValidator(data.users, creating)}\n        />\n      </>\n    );\n  };\n\n  return (\n    <SectionContent title='Manage Users' titleGutter>\n      {content()}\n    </SectionContent>\n  );\n};\n\nexport default SecuritySettingsForm;\n"]},"metadata":{},"sourceType":"module"}