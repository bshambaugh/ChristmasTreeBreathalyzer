{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useContext,useState}from\"react\";import{useSnackbar}from\"notistack\";import{Avatar,Box,Button,Dialog,DialogActions,DialogContent,DialogTitle,Divider,List,ListItem,ListItemAvatar,ListItemText}from\"@mui/material\";import DevicesIcon from'@mui/icons-material/Devices';import ShowChartIcon from'@mui/icons-material/ShowChart';import MemoryIcon from'@mui/icons-material/Memory';import AppsIcon from'@mui/icons-material/Apps';import DataUsageIcon from'@mui/icons-material/DataUsage';import SdStorageIcon from'@mui/icons-material/SdStorage';import FolderIcon from'@mui/icons-material/Folder';import RefreshIcon from'@mui/icons-material/Refresh';import PowerSettingsNewIcon from'@mui/icons-material/PowerSettingsNew';import SettingsBackupRestoreIcon from'@mui/icons-material/SettingsBackupRestore';import*as SystemApi from\"../../api/system\";import{EspPlatform}from\"../../types\";import{ButtonRow,FormLoader,SectionContent}from\"../../components\";import{extractErrorMessage,useRest}from\"../../utils\";import{AuthenticatedContext}from\"../../contexts/authentication\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function formatNumber(num){return new Intl.NumberFormat().format(num);}var SystemStatusForm=function SystemStatusForm(){var _useRest=useRest({read:SystemApi.readSystemStatus}),loadData=_useRest.loadData,data=_useRest.data,errorMessage=_useRest.errorMessage;var _useContext=useContext(AuthenticatedContext),me=_useContext.me;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),confirmRestart=_useState2[0],setConfirmRestart=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),confirmFactoryReset=_useState4[0],setConfirmFactoryReset=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),processing=_useState6[0],setProcessing=_useState6[1];var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var restart=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setProcessing(true);_context.prev=1;_context.next=4;return SystemApi.restart();case 4:enqueueSnackbar(\"Device is restarting\",{variant:'info'});_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context.t0,'Problem restarting device'),{variant:'error'});case 10:_context.prev=10;setConfirmRestart(false);setProcessing(false);return _context.finish(10);case 14:case\"end\":return _context.stop();}}},_callee,null,[[1,7,10,14]]);}));return function restart(){return _ref.apply(this,arguments);};}();var renderRestartDialog=function renderRestartDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:confirmRestart,onClose:function onClose(){return setConfirmRestart(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Restart\"}),/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:\"Are you sure you want to restart the device?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setConfirmRestart(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PowerSettingsNewIcon,{}),variant:\"contained\",onClick:restart,disabled:processing,color:\"primary\",autoFocus:true,children:\"Restart\"})]})]});};var factoryReset=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setProcessing(true);_context2.prev=1;_context2.next=4;return SystemApi.factoryReset();case 4:enqueueSnackbar(\"Device has been factory reset and will now restart\",{variant:'info'});_context2.next=10;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](1);enqueueSnackbar(extractErrorMessage(_context2.t0,'Problem factory resetting the device'),{variant:'error'});case 10:_context2.prev=10;setConfirmFactoryReset(false);setProcessing(false);return _context2.finish(10);case 14:case\"end\":return _context2.stop();}}},_callee2,null,[[1,7,10,14]]);}));return function factoryReset(){return _ref2.apply(this,arguments);};}();var renderFactoryResetDialog=function renderFactoryResetDialog(){return/*#__PURE__*/_jsxs(Dialog,{open:confirmFactoryReset,onClose:function onClose(){return setConfirmFactoryReset(false);},children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Confirm Factory Reset\"}),/*#__PURE__*/_jsx(DialogContent,{dividers:true,children:\"Are you sure you want to reset the device to its factory defaults?\"}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:function onClick(){return setConfirmFactoryReset(false);},color:\"secondary\",children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SettingsBackupRestoreIcon,{}),variant:\"contained\",onClick:factoryReset,disabled:processing,autoFocus:true,color:\"error\",children:\"Factory Reset\"})]})]});};var content=function content(){if(!data){return/*#__PURE__*/_jsx(FormLoader,{onRetry:loadData,errorMessage:errorMessage});}return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DevicesIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Device (Platform / SDK)\",secondary:data.esp_platform+' / '+data.sdk_version})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(ShowChartIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"CPU Frequency\",secondary:data.cpu_freq_mhz+' MHz'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(MemoryIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Heap (Free / Max Alloc)\",secondary:formatNumber(data.free_heap)+' / '+formatNumber(data.max_alloc_heap)+' bytes '+(data.esp_platform===EspPlatform.ESP8266?'('+data.heap_fragmentation+'% fragmentation)':'')})]}),data.esp_platform===EspPlatform.ESP32&&data.psram_size>0&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(AppsIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"PSRAM (Size / Free)\",secondary:formatNumber(data.psram_size)+' / '+formatNumber(data.free_psram)+' bytes'})]})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(DataUsageIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Sketch (Size / Free)\",secondary:formatNumber(data.sketch_size)+' / '+formatNumber(data.free_sketch_space)+' bytes'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(SdStorageIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Flash Chip (Size / Speed)\",secondary:formatNumber(data.flash_chip_size)+' bytes / '+(data.flash_chip_speed/1000000).toFixed(0)+' MHz'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:/*#__PURE__*/_jsx(FolderIcon,{})})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"File System (Used / Total)\",secondary:formatNumber(data.fs_used)+' / '+formatNumber(data.fs_total)+' bytes ('+formatNumber(data.fs_total-data.fs_used)+'\\xa0bytes free)'})]}),/*#__PURE__*/_jsx(Divider,{variant:\"inset\",component:\"li\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexWrap:\"wrap\",children:[/*#__PURE__*/_jsx(Box,{flexGrow:1,children:/*#__PURE__*/_jsx(ButtonRow,{mt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(RefreshIcon,{}),variant:\"contained\",color:\"secondary\",onClick:loadData,children:\"Refresh\"})})}),me.admin&&/*#__PURE__*/_jsx(Box,{flexWrap:\"nowrap\",whiteSpace:\"nowrap\",children:/*#__PURE__*/_jsxs(ButtonRow,{mt:1,children:[/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PowerSettingsNewIcon,{}),variant:\"contained\",color:\"primary\",onClick:function onClick(){return setConfirmRestart(true);},children:\"Restart\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(SettingsBackupRestoreIcon,{}),variant:\"contained\",onClick:function onClick(){return setConfirmFactoryReset(true);},color:\"error\",children:\"Factory reset\"})]})})]}),renderRestartDialog(),renderFactoryResetDialog()]});};return/*#__PURE__*/_jsx(SectionContent,{title:\"System Status\",titleGutter:true,children:content()});};export default SystemStatusForm;","map":null,"metadata":{},"sourceType":"module"}