{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Downloads/esp8266-react/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useEffect,useState,useCallback,useRef}from'react';import{useSnackbar}from'notistack';import{Button}from'@mui/material';import PermScanWifiIcon from'@mui/icons-material/PermScanWifi';import*as WiFiApi from\"../../api/wifi\";import{ButtonRow,FormLoader,SectionContent}from'../../components';import{extractErrorMessage}from'../../utils';import WiFiNetworkSelector from'./WiFiNetworkSelector';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var NUM_POLLS=10;var POLLING_FREQUENCY=500;var compareNetworks=function compareNetworks(network1,network2){if(network1.rssi<network2.rssi)return 1;if(network1.rssi>network2.rssi)return-1;return 0;};var WiFiNetworkScanner=function WiFiNetworkScanner(){var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var pollCount=useRef(0);var _useState=useState(),_useState2=_slicedToArray(_useState,2),networkList=_useState2[0],setNetworkList=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var finishedWithError=useCallback(function(message){enqueueSnackbar(message,{variant:'error'});setNetworkList(undefined);setErrorMessage(message);},[enqueueSnackbar]);var pollNetworkList=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,completedPollCount,newNetworkList;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return WiFiApi.listNetworks();case 3:response=_context.sent;if(response.status===202){completedPollCount=pollCount.current+1;if(completedPollCount<NUM_POLLS){pollCount.current=completedPollCount;setTimeout(pollNetworkList,POLLING_FREQUENCY);}else{finishedWithError(\"Device did not return network list in timely manner\");}}else{newNetworkList=response.data;newNetworkList.networks.sort(compareNetworks);setNetworkList(newNetworkList);}_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);finishedWithError(extractErrorMessage(_context.t0,'Problem listing WiFi networks'));case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);})),[finishedWithError]);var startNetworkScan=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pollCount.current=0;setNetworkList(undefined);setErrorMessage(undefined);_context2.prev=3;_context2.next=6;return WiFiApi.scanNetworks();case 6:setTimeout(pollNetworkList,POLLING_FREQUENCY);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](3);finishedWithError(extractErrorMessage(_context2.t0,'Problem scanning for WiFi networks'));case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[3,9]]);})),[finishedWithError,pollNetworkList]);useEffect(function(){startNetworkScan();},[startNetworkScan]);var renderNetworkScanner=function renderNetworkScanner(){if(!networkList){return/*#__PURE__*/_jsx(FormLoader,{message:\"Scanning\\u2026\",errorMessage:errorMessage});}return/*#__PURE__*/_jsx(WiFiNetworkSelector,{networkList:networkList});};return/*#__PURE__*/_jsxs(SectionContent,{title:\"Network Scanner\",children:[renderNetworkScanner(),/*#__PURE__*/_jsx(ButtonRow,{pt:1,children:/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(PermScanWifiIcon,{}),variant:\"contained\",color:\"secondary\",onClick:startNetworkScan,disabled:!errorMessage&&!networkList,children:\"Scan again\\u2026\"})})]});};export default WiFiNetworkScanner;","map":null,"metadata":{},"sourceType":"module"}