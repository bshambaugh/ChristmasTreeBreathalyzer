{"ast":null,"code":"import _asyncToGenerator from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/node_modules/@babel/runtime/regenerator/index.js\";import{useCallback,useEffect,useState}from'react';import axios from'axios';import{useSnackbar}from\"notistack\";import{extractErrorMessage}from'../../utils';var useFileUpload=function useFileUpload(_ref){var upload=_ref.upload;var _useSnackbar=useSnackbar(),enqueueSnackbar=_useSnackbar.enqueueSnackbar;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),uploading=_useState2[0],setUploading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),uploadProgress=_useState4[0],setUploadProgress=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),uploadCancelToken=_useState6[0],setUploadCancelToken=_useState6[1];var resetUploadingStates=function resetUploadingStates(){setUploading(false);setUploadProgress(undefined);setUploadCancelToken(undefined);};var cancelUpload=useCallback(function(){uploadCancelToken===null||uploadCancelToken===void 0?void 0:uploadCancelToken.cancel();resetUploadingStates();},[uploadCancelToken]);useEffect(function(){return function(){uploadCancelToken===null||uploadCancelToken===void 0?void 0:uploadCancelToken.cancel();};},[uploadCancelToken]);var uploadFile=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(images){var cancelToken;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;cancelToken=axios.CancelToken.source();setUploadCancelToken(cancelToken);setUploading(true);_context.next=6;return upload(images[0],{onUploadProgress:setUploadProgress,cancelToken:cancelToken.token});case 6:resetUploadingStates();enqueueSnackbar('Upload successful',{variant:'success'});_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);if(axios.isCancel(_context.t0)){enqueueSnackbar('Upload aborted',{variant:'warning'});}else{resetUploadingStates();enqueueSnackbar(extractErrorMessage(_context.t0,'Upload failed'),{variant:'error'});}case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function uploadFile(_x){return _ref2.apply(this,arguments);};}();return[uploadFile,cancelUpload,uploading,uploadProgress];};export default useFileUpload;","map":{"version":3,"sources":["/home/brent/Documents/PlatformIO/Projects/ESP32_C3_Test/interface/src/components/upload/useFileUpload.ts"],"names":["useCallback","useEffect","useState","axios","useSnackbar","extractErrorMessage","useFileUpload","upload","enqueueSnackbar","uploading","setUploading","uploadProgress","setUploadProgress","uploadCancelToken","setUploadCancelToken","resetUploadingStates","undefined","cancelUpload","cancel","uploadFile","images","cancelToken","CancelToken","source","onUploadProgress","token","variant","isCancel"],"mappings":"wcAAA,OAASA,WAAT,CAAsBC,SAAtB,CAAiCC,QAAjC,KAAiD,OAAjD,CACA,MAAOC,CAAAA,KAAP,KAAuD,OAAvD,CACA,OAASC,WAAT,KAA4B,WAA5B,CAEA,OAASC,mBAAT,KAAoC,aAApC,CAOA,GAAMC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,MAAoC,IAAjCC,CAAAA,MAAiC,MAAjCA,MAAiC,CACxD,iBAA4BH,WAAW,EAAvC,CAAQI,eAAR,cAAQA,eAAR,CACA,cAAkCN,QAAQ,CAAU,KAAV,CAA1C,wCAAOO,SAAP,eAAkBC,YAAlB,eACA,eAA4CR,QAAQ,EAApD,yCAAOS,cAAP,eAAuBC,iBAAvB,eACA,eAAkDV,QAAQ,EAA1D,yCAAOW,iBAAP,eAA0BC,oBAA1B,eAEA,GAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,EAAM,CACjCL,YAAY,CAAC,KAAD,CAAZ,CACAE,iBAAiB,CAACI,SAAD,CAAjB,CACAF,oBAAoB,CAACE,SAAD,CAApB,CACD,CAJD,CAMA,GAAMC,CAAAA,YAAY,CAAGjB,WAAW,CAAC,UAAM,CACrCa,iBAAiB,OAAjB,EAAAA,iBAAiB,SAAjB,QAAAA,iBAAiB,CAAEK,MAAnB,GACAH,oBAAoB,GACrB,CAH+B,CAG7B,CAACF,iBAAD,CAH6B,CAAhC,CAKAZ,SAAS,CAAC,UAAM,CACd,MAAO,WAAM,CACXY,iBAAiB,OAAjB,EAAAA,iBAAiB,SAAjB,QAAAA,iBAAiB,CAAEK,MAAnB,GACD,CAFD,CAGD,CAJQ,CAIN,CAACL,iBAAD,CAJM,CAAT,CAMA,GAAMM,CAAAA,UAAU,2FAAG,iBAAOC,MAAP,kJAETC,WAFS,CAEKlB,KAAK,CAACmB,WAAN,CAAkBC,MAAlB,EAFL,CAGfT,oBAAoB,CAACO,WAAD,CAApB,CACAX,YAAY,CAAC,IAAD,CAAZ,CAJe,sBAKTH,CAAAA,MAAM,CAACa,MAAM,CAAC,CAAD,CAAP,CAAY,CACtBI,gBAAgB,CAAEZ,iBADI,CAEtBS,WAAW,CAAEA,WAAW,CAACI,KAFH,CAAZ,CALG,QASfV,oBAAoB,GACpBP,eAAe,CAAC,mBAAD,CAAsB,CAAEkB,OAAO,CAAE,SAAX,CAAtB,CAAf,CAVe,iFAYf,GAAIvB,KAAK,CAACwB,QAAN,aAAJ,CAA2B,CACzBnB,eAAe,CAAC,gBAAD,CAAmB,CAAEkB,OAAO,CAAE,SAAX,CAAnB,CAAf,CACD,CAFD,IAEO,CACLX,oBAAoB,GACpBP,eAAe,CAACH,mBAAmB,aAAQ,eAAR,CAApB,CAA8C,CAAEqB,OAAO,CAAE,OAAX,CAA9C,CAAf,CACD,CAjBc,qEAAH,kBAAVP,CAAAA,UAAU,6CAAhB,CAqBA,MAAO,CAACA,UAAD,CAAaF,YAAb,CAA2BR,SAA3B,CAAsCE,cAAtC,CAAP,CACD,CA7CD,CA+CA,cAAeL,CAAAA,aAAf","sourcesContent":["import { useCallback, useEffect, useState } from 'react';\nimport axios, { AxiosPromise, CancelTokenSource } from 'axios';\nimport { useSnackbar } from \"notistack\";\n\nimport { extractErrorMessage } from '../../utils';\nimport { FileUploadConfig } from '../../api/endpoints';\n\ninterface MediaUploadOptions {\n  upload: (file: File, config?: FileUploadConfig) => AxiosPromise<void>;\n}\n\nconst useFileUpload = ({ upload }: MediaUploadOptions) => {\n  const { enqueueSnackbar } = useSnackbar();\n  const [uploading, setUploading] = useState<boolean>(false);\n  const [uploadProgress, setUploadProgress] = useState<ProgressEvent>();\n  const [uploadCancelToken, setUploadCancelToken] = useState<CancelTokenSource>();\n\n  const resetUploadingStates = () => {\n    setUploading(false);\n    setUploadProgress(undefined);\n    setUploadCancelToken(undefined);\n  };\n\n  const cancelUpload = useCallback(() => {\n    uploadCancelToken?.cancel();\n    resetUploadingStates();\n  }, [uploadCancelToken]);\n\n  useEffect(() => {\n    return () => {\n      uploadCancelToken?.cancel();\n    };\n  }, [uploadCancelToken]);\n\n  const uploadFile = async (images: File[]) => {\n    try {\n      const cancelToken = axios.CancelToken.source();\n      setUploadCancelToken(cancelToken);\n      setUploading(true);\n      await upload(images[0], {\n        onUploadProgress: setUploadProgress,\n        cancelToken: cancelToken.token\n      });\n      resetUploadingStates();\n      enqueueSnackbar('Upload successful', { variant: 'success' });\n    } catch (error: any) {\n      if (axios.isCancel(error)) {\n        enqueueSnackbar('Upload aborted', { variant: 'warning' });\n      } else {\n        resetUploadingStates();\n        enqueueSnackbar(extractErrorMessage(error, 'Upload failed'), { variant: 'error' });\n      }\n    }\n  };\n\n  return [uploadFile, cancelUpload, uploading, uploadProgress] as const;\n};\n\nexport default useFileUpload;\n"]},"metadata":{},"sourceType":"module"}